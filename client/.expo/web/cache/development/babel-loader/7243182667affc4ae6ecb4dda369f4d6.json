{"ast":null,"code":"import io from \"socket.io-client\";\nimport axios from \"axios\";\nimport { apiConfig } from \"../config\";\nexport var devMiddleware = function devMiddleware(store) {\n  return function (next) {\n    return function (action) {\n      console.log(action.type);\n      next(action);\n    };\n  };\n};\nexport var socketMiddleware = function socketMiddleware() {\n  var socket;\n  return function (store) {\n    return function (next) {\n      return function (action) {\n        if (typeof action === \"function\") {\n          return next(action);\n        }\n\n        if (action.type === \"REQUEST_LOG_IN:SUCCESS\" || action.type === \"REQUEST_SIGN_UP:SUCCESS\") {\n          var token = action.data.token;\n          socket = io(apiConfig.baseUrl.replace(\"/api/\", \"\"), {\n            forceNode: true,\n            transportOptions: {\n              polling: {\n                extraHeaders: {\n                  \"Access-Control-Allow-Origin\": \"*\",\n                  authorization: token\n                }\n              }\n            }\n          });\n          socket.on(\"connected\", function (data) {\n            console.log(\"Socket connected\");\n          });\n          socket.on(\"authenticated\", function (data) {\n            console.log(\"Socket authenticated\");\n          });\n          socket.on(\"message\", function (data) {\n            store.dispatch({\n              type: \"RECEIVE_MESSAGE\",\n              message: data.message,\n              conversation: data.conversation,\n              newConv: data.newConv,\n              receivedAt: new Date()\n            });\n          });\n        }\n\n        if (action.type.substring(0, 6) === \"SOCKET\") {\n          socket.emit(action.event, action.payload);\n        }\n\n        if (action.type === \"REQUEST_LOG_OUT:SUCCESS\") {\n          socket.disconnect();\n        }\n\n        return next(action);\n      };\n    };\n  };\n};\nexport var axiosMiddleware = function axiosMiddleware(store) {\n  return function (next) {\n    return function (action) {\n      if (action.type.substring(0, 7) === \"REQUEST\" && action.type.includes(\":\") === false) {\n        var https;\n\n        if (action.type.substring(0, 14) === \"REQUEST_UPLOAD\") {\n          https = axios.create({\n            baseURL: apiConfig.baseUrl,\n            timeout: 3000,\n            headers: {\n              accept: \"application/json\",\n              \"Access-Control-Allow-Origin\": \"*\",\n              \"Content-Type\": \"multipart/form-data\",\n              Authorization: \"Bearer \" + store.getState().auth.token\n            }\n          });\n        } else {\n          https = axios.create({\n            baseURL: apiConfig.baseUrl,\n            timeout: 3000,\n            headers: {\n              \"Access-Control-Allow-Origin\": \"*\",\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + store.getState().auth.token\n            }\n          });\n        }\n\n        var request = new Promise(function (resolve, reject) {\n          var res;\n\n          switch (action.method) {\n            case \"GET\":\n              res = https.get(action.route);\n              return resolve(res);\n\n            case \"POST\":\n              res = https.post(action.route, action.payload);\n              return resolve(res);\n\n            case \"DELETE\":\n              res = https.delete(action.route, action.payload);\n              return resolve(res);\n\n            case \"PATCH\":\n              res = https.patch(action.route, action.payload);\n              return resolve(res);\n\n            default:\n              return;\n          }\n        });\n        request.then(function (res) {\n          if (action.successNotification) {\n            store.dispatch({\n              type: \"NOTIFY_USER\",\n              notification: action.successNotification\n            });\n          }\n\n          store.dispatch({\n            type: action.type + \":SUCCESS\",\n            data: res.data,\n            receivedAt: new Date()\n          });\n        }).catch(function (err) {\n          console.log(err.response);\n          store.dispatch({\n            type: action.type + \":ERROR\",\n            error: err,\n            receivedAt: new Date()\n          });\n\n          if (action.errorNotification) {\n            var _err$response;\n\n            store.dispatch({\n              type: \"NOTIFY_USER\",\n              notification: {\n                variant: \"error\",\n                timeout: 3000,\n                message: ((_err$response = err.response) == null ? void 0 : _err$response.statusText.replace(\"Error: \", \"\")) || \"Cela n'a pas marché...\"\n              }\n            });\n          }\n        });\n        next(action);\n      } else {\n        next(action);\n      }\n    };\n  };\n};","map":{"version":3,"sources":["/home/gaetan/Documents/GATE/app/frontend/src/store/reduxMiddlewares.js"],"names":["io","axios","apiConfig","devMiddleware","store","next","action","console","log","type","socketMiddleware","socket","token","data","baseUrl","replace","forceNode","transportOptions","polling","extraHeaders","authorization","on","dispatch","message","conversation","newConv","receivedAt","Date","substring","emit","event","payload","disconnect","axiosMiddleware","includes","https","create","baseURL","timeout","headers","accept","Authorization","getState","auth","request","Promise","resolve","reject","res","method","get","route","post","delete","patch","then","successNotification","notification","catch","err","response","error","errorNotification","variant","statusText"],"mappings":"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","sourcesContent":["import io from \"socket.io-client\";\nimport axios from \"axios\";\nimport { apiConfig } from \"../config\";\n\nexport const devMiddleware = store => next => action => {\n  console.log(action.type);\n  next(action);\n};\n\nexport const socketMiddleware = () => {\n  let socket;\n  return store => next => action => {\n    if (typeof action === \"function\") {\n      return next(action);\n    }\n\n    if (\n      action.type === \"REQUEST_LOG_IN:SUCCESS\" ||\n      action.type === \"REQUEST_SIGN_UP:SUCCESS\"\n    ) {\n      const { token } = action.data;\n      socket = io(apiConfig.baseUrl.replace(\"/api/\", \"\"), {\n        forceNode: true,\n        transportOptions: {\n          polling: {\n            extraHeaders: {\n              \"Access-Control-Allow-Origin\": \"*\",\n              authorization: token\n            }\n          }\n        }\n      });\n      socket.on(\"connected\", data => {\n        console.log(\"Socket connected\");\n      });\n      socket.on(\"authenticated\", data => {\n        console.log(\"Socket authenticated\");\n      });\n      socket.on(\"message\", data => {\n        store.dispatch({\n          type: \"RECEIVE_MESSAGE\",\n          message: data.message,\n          conversation: data.conversation,\n          newConv: data.newConv,\n          receivedAt: new Date()\n        });\n      });\n    }\n    if (action.type.substring(0, 6) === \"SOCKET\") {\n      socket.emit(action.event, action.payload);\n    }\n    if (action.type === \"REQUEST_LOG_OUT:SUCCESS\") {\n      socket.disconnect();\n    }\n    return next(action);\n  };\n};\n\nexport const axiosMiddleware = store => next => action => {\n  if (\n    action.type.substring(0, 7) === \"REQUEST\" &&\n    action.type.includes(\":\") === false\n  ) {\n    let https;\n    if (action.type.substring(0, 14) === \"REQUEST_UPLOAD\") {\n      https = axios.create({\n        baseURL: apiConfig.baseUrl,\n        timeout: 3000,\n        headers: {\n          accept: \"application/json\",\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: `Bearer ${store.getState().auth.token}`\n        }\n      });\n    } else {\n      https = axios.create({\n        baseURL: apiConfig.baseUrl,\n        timeout: 3000,\n        headers: {\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${store.getState().auth.token}`\n        }\n      });\n    }\n    const request = new Promise(function(resolve, reject) {\n      let res;\n\n      switch (action.method) {\n        case \"GET\":\n          res = https.get(action.route);\n          return resolve(res);\n        case \"POST\":\n          res = https.post(action.route, action.payload);\n          return resolve(res);\n        case \"DELETE\":\n          res = https.delete(action.route, action.payload);\n          return resolve(res);\n        case \"PATCH\":\n          res = https.patch(action.route, action.payload);\n          return resolve(res);\n        default:\n          return;\n      }\n    });\n    request\n      .then(res => {\n        if (action.successNotification) {\n          store.dispatch({\n            type: \"NOTIFY_USER\",\n            notification: action.successNotification\n          });\n        }\n        store.dispatch({\n          type: `${action.type}:SUCCESS`,\n          data: res.data,\n          receivedAt: new Date()\n        });\n      })\n      .catch(err => {\n        console.log(err.response);\n        store.dispatch({\n          type: `${action.type}:ERROR`,\n          error: err,\n          receivedAt: new Date()\n        });\n        if (action.errorNotification) {\n          store.dispatch({\n            type: \"NOTIFY_USER\",\n            notification: {\n              variant: \"error\",\n              timeout: 3000,\n              message:\n                err.response?.statusText.replace(\"Error: \", \"\") ||\n                \"Cela n'a pas marché...\"\n            }\n          });\n        }\n      });\n\n    next(action);\n  } else {\n    next(action);\n  }\n};\n"]},"metadata":{},"sourceType":"module"}