{"ast":null,"code":"import * as FileSystem from \"expo-file-system\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nexport var fetchFile = function fetchFile(bucketName, fileId) {\n  return {\n    type: \"REQUEST_FILE\",\n    route: \"files/\" + bucketName + \"/\" + fileId,\n    method: \"GET\"\n  };\n};\nexport var deleteFile = function deleteFile(bucketName, fileId) {\n  return {\n    type: \"REQUEST_DELETE_FILE\",\n    route: \"files/\" + bucketName + \"/\" + fileId,\n    method: \"DELETE\",\n    successNotification: {\n      message: \"Votre document a bien été supprimé de la base de données.\",\n      variant: \"success\",\n      timeout: 2000\n    },\n    errorNotification: {\n      message: \"Cela n'a pas marché... Essayez de nouveau.\",\n      variant: \"error\",\n      timeout: 2000\n    }\n  };\n};\n\nfunction dataURItoBlob(dataURI) {\n  var byteString = atob(dataURI.split(\",\")[1]);\n  var mimeString = dataURI.split(\",\")[0].split(\":\")[1].split(\";\")[0];\n  var ab = new ArrayBuffer(byteString.length);\n  var ia = new Uint8Array(ab);\n\n  for (var i = 0; i < byteString.length; i++) {\n    ia[i] = byteString.charCodeAt(i);\n  }\n\n  var blob = new Blob([ab], {\n    type: mimeString\n  });\n  return blob;\n}\n\nfunction dataURLtoBlob(dataurl) {\n  var arr = dataurl.split(\",\"),\n      mime = arr[0].match(/:(.*?);/)[1],\n      bstr = atob(arr[1]),\n      n = bstr.length,\n      u8arr = new Uint8Array(n);\n\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n\n  return new Blob([u8arr], {\n    type: mime\n  });\n}\n\nexport var uploadFile = function uploadFile(file, bucketName, name) {\n  var formData = new FormData();\n\n  if (Platform.OS = \"web\") {\n    var blob = dataURLtoBlob(file.uri);\n    console.log(blob);\n    formData.append(\"file\", blob);\n    formData.append(\"file\", file.uri);\n  } else {\n    formData.append(\"file\", new File(file, name));\n  }\n\n  console.log(formData);\n  name && formData.append(\"name\", name);\n  return {\n    type: \"REQUEST_UPLOAD_FILE\",\n    route: \"files/\" + bucketName,\n    payload: formData,\n    method: \"POST\",\n    errorNotification: {\n      message: \"Cela n'a pas marché... Essayez de nouveau.\",\n      variant: \"error\",\n      timeout: 2000\n    }\n  };\n};","map":{"version":3,"sources":["/home/gaetan/Documents/GATE/app/client/src/actions/filesActions.js"],"names":["FileSystem","fetchFile","bucketName","fileId","type","route","method","deleteFile","successNotification","message","variant","timeout","errorNotification","dataURItoBlob","dataURI","byteString","atob","split","mimeString","ab","ArrayBuffer","length","ia","Uint8Array","i","charCodeAt","blob","Blob","dataURLtoBlob","dataurl","arr","mime","match","bstr","n","u8arr","uploadFile","file","name","formData","FormData","Platform","OS","uri","console","log","append","File","payload"],"mappings":"AAAA,OAAO,KAAKA,UAAZ,MAA4B,kBAA5B;;AAGA,OAAO,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAACC,UAAD,EAAaC,MAAb,EAAwB;AAC/C,SAAO;AACLC,IAAAA,IAAI,EAAE,cADD;AAELC,IAAAA,KAAK,aAAWH,UAAX,SAAyBC,MAFzB;AAGLG,IAAAA,MAAM,EAAE;AAHH,GAAP;AAKD,CANM;AAQP,OAAO,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACL,UAAD,EAAaC,MAAb,EAAwB;AAChD,SAAO;AACLC,IAAAA,IAAI,EAAE,qBADD;AAELC,IAAAA,KAAK,aAAWH,UAAX,SAAyBC,MAFzB;AAGLG,IAAAA,MAAM,EAAE,QAHH;AAILE,IAAAA,mBAAmB,EAAE;AACnBC,MAAAA,OAAO,EAAE,2DADU;AAEnBC,MAAAA,OAAO,EAAE,SAFU;AAGnBC,MAAAA,OAAO,EAAE;AAHU,KAJhB;AASLC,IAAAA,iBAAiB,EAAE;AACjBH,MAAAA,OAAO,EAAE,4CADQ;AAEjBC,MAAAA,OAAO,EAAE,OAFQ;AAGjBC,MAAAA,OAAO,EAAE;AAHQ;AATd,GAAP;AAeD,CAhBM;;AAkBP,SAASE,aAAT,CAAuBC,OAAvB,EAAgC;AAG9B,MAAIC,UAAU,GAAGC,IAAI,CAACF,OAAO,CAACG,KAAR,CAAc,GAAd,EAAmB,CAAnB,CAAD,CAArB;AAEA,MAAIC,UAAU,GAAGJ,OAAO,CAACG,KAAR,CAAc,GAAd,EAAmB,CAAnB,EAAsBA,KAAtB,CAA4B,GAA5B,EAAiC,CAAjC,EAAoCA,KAApC,CAA0C,GAA1C,EAA+C,CAA/C,CAAjB;AAEA,MAAIE,EAAE,GAAG,IAAIC,WAAJ,CAAgBL,UAAU,CAACM,MAA3B,CAAT;AAEA,MAAIC,EAAE,GAAG,IAAIC,UAAJ,CAAeJ,EAAf,CAAT;;AAEA,OAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGT,UAAU,CAACM,MAA/B,EAAuCG,CAAC,EAAxC,EAA4C;AAC1CF,IAAAA,EAAE,CAACE,CAAD,CAAF,GAAQT,UAAU,CAACU,UAAX,CAAsBD,CAAtB,CAAR;AACD;;AAED,MAAIE,IAAI,GAAG,IAAIC,IAAJ,CAAS,CAACR,EAAD,CAAT,EAAe;AAAEf,IAAAA,IAAI,EAAEc;AAAR,GAAf,CAAX;AACA,SAAOQ,IAAP;AACD;;AACD,SAASE,aAAT,CAAuBC,OAAvB,EAAgC;AAC9B,MAAIC,GAAG,GAAGD,OAAO,CAACZ,KAAR,CAAc,GAAd,CAAV;AAAA,MACEc,IAAI,GAAGD,GAAG,CAAC,CAAD,CAAH,CAAOE,KAAP,CAAa,SAAb,EAAwB,CAAxB,CADT;AAAA,MAEEC,IAAI,GAAGjB,IAAI,CAACc,GAAG,CAAC,CAAD,CAAJ,CAFb;AAAA,MAGEI,CAAC,GAAGD,IAAI,CAACZ,MAHX;AAAA,MAIEc,KAAK,GAAG,IAAIZ,UAAJ,CAAeW,CAAf,CAJV;;AAKA,SAAOA,CAAC,EAAR,EAAY;AACVC,IAAAA,KAAK,CAACD,CAAD,CAAL,GAAWD,IAAI,CAACR,UAAL,CAAgBS,CAAhB,CAAX;AACD;;AACD,SAAO,IAAIP,IAAJ,CAAS,CAACQ,KAAD,CAAT,EAAkB;AAAE/B,IAAAA,IAAI,EAAE2B;AAAR,GAAlB,CAAP;AACD;;AAED,OAAO,IAAMK,UAAU,GAAG,SAAbA,UAAa,CAACC,IAAD,EAAOnC,UAAP,EAAmBoC,IAAnB,EAA4B;AACpD,MAAIC,QAAQ,GAAG,IAAIC,QAAJ,EAAf;;AAEA,MAAKC,QAAQ,CAACC,EAAT,GAAc,KAAnB,EAA2B;AACzB,QAAIhB,IAAI,GAAGE,aAAa,CAACS,IAAI,CAACM,GAAN,CAAxB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAYnB,IAAZ;AACAa,IAAAA,QAAQ,CAACO,MAAT,CAAgB,MAAhB,EAAwBpB,IAAxB;AAEAa,IAAAA,QAAQ,CAACO,MAAT,CAAgB,MAAhB,EAAwBT,IAAI,CAACM,GAA7B;AACD,GAND,MAMO;AACLJ,IAAAA,QAAQ,CAACO,MAAT,CAAgB,MAAhB,EAAwB,IAAIC,IAAJ,CAASV,IAAT,EAAeC,IAAf,CAAxB;AAED;;AAEDM,EAAAA,OAAO,CAACC,GAAR,CAAYN,QAAZ;AAEAD,EAAAA,IAAI,IAAIC,QAAQ,CAACO,MAAT,CAAgB,MAAhB,EAAwBR,IAAxB,CAAR;AAGA,SAAO;AACLlC,IAAAA,IAAI,EAAE,qBADD;AAELC,IAAAA,KAAK,aAAWH,UAFX;AAGL8C,IAAAA,OAAO,EAAET,QAHJ;AAILjC,IAAAA,MAAM,EAAE,MAJH;AAKLM,IAAAA,iBAAiB,EAAE;AACjBH,MAAAA,OAAO,EAAE,4CADQ;AAEjBC,MAAAA,OAAO,EAAE,OAFQ;AAGjBC,MAAAA,OAAO,EAAE;AAHQ;AALd,GAAP;AAWD,CA9BM","sourcesContent":["import * as FileSystem from \"expo-file-system\";\nimport { Platform } from \"react-native\";\n\nexport const fetchFile = (bucketName, fileId) => {\n  return {\n    type: \"REQUEST_FILE\",\n    route: `files/${bucketName}/${fileId}`,\n    method: \"GET\",\n  };\n};\n\nexport const deleteFile = (bucketName, fileId) => {\n  return {\n    type: \"REQUEST_DELETE_FILE\",\n    route: `files/${bucketName}/${fileId}`,\n    method: \"DELETE\",\n    successNotification: {\n      message: \"Votre document a bien été supprimé de la base de données.\",\n      variant: \"success\",\n      timeout: 2000,\n    },\n    errorNotification: {\n      message: \"Cela n'a pas marché... Essayez de nouveau.\",\n      variant: \"error\",\n      timeout: 2000,\n    },\n  };\n};\n\nfunction dataURItoBlob(dataURI) {\n  // convert base64 to raw binary data held in a string\n  // doesn't handle URLEncoded DataURIs - see SO answer #6850276 for code that does this\n  var byteString = atob(dataURI.split(\",\")[1]);\n  // separate out the mime component\n  var mimeString = dataURI.split(\",\")[0].split(\":\")[1].split(\";\")[0];\n  // write the bytes of the string to an ArrayBuffer\n  var ab = new ArrayBuffer(byteString.length);\n  // create a view into the buffer\n  var ia = new Uint8Array(ab);\n  // set the bytes of the buffer to the correct values\n  for (var i = 0; i < byteString.length; i++) {\n    ia[i] = byteString.charCodeAt(i);\n  }\n  // write the ArrayBuffer to a blob, and you're done\n  var blob = new Blob([ab], { type: mimeString });\n  return blob;\n}\nfunction dataURLtoBlob(dataurl) {\n  var arr = dataurl.split(\",\"),\n    mime = arr[0].match(/:(.*?);/)[1],\n    bstr = atob(arr[1]),\n    n = bstr.length,\n    u8arr = new Uint8Array(n);\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new Blob([u8arr], { type: mime });\n}\n\nexport const uploadFile = (file, bucketName, name) => {\n  let formData = new FormData();\n\n  if ((Platform.OS = \"web\")) {\n    let blob = dataURLtoBlob(file.uri);\n    console.log(blob);\n    formData.append(\"file\", blob);\n\n    formData.append(\"file\", file.uri);\n  } else {\n    formData.append(\"file\", new File(file, name));\n    //  formData.append(\"file\", FileSystem.readAsStringAsync(file.uri));\n  }\n\n  console.log(formData);\n\n  name && formData.append(\"name\", name);\n  // formData.append(\"file\", fs.createReadStream(file.uri));\n\n  return {\n    type: \"REQUEST_UPLOAD_FILE\",\n    route: `files/${bucketName}`,\n    payload: formData,\n    method: \"POST\",\n    errorNotification: {\n      message: \"Cela n'a pas marché... Essayez de nouveau.\",\n      variant: \"error\",\n      timeout: 2000,\n    },\n  };\n};\n"]},"metadata":{},"sourceType":"module"}