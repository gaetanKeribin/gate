{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport io from \"socket.io-client\";\nimport axios from \"axios\";\nimport { apiConfig } from \"../config\";\nimport { showOverlay } from \"../actions/overlayAction\";\nexport var devMiddleware = function devMiddleware(store) {\n  return function (next) {\n    return function (action) {\n      console.log(action.type);\n      return next(action);\n    };\n  };\n};\nexport var socketMiddleware = function socketMiddleware() {\n  var socket;\n  return function (store) {\n    return function (next) {\n      return function (action) {\n        if (action.type === \"REQUEST_LOG_IN:SUCCESS\" || action.type === \"REQUEST_SIGN_UP:SUCCESS\" || action.type === \"REQUEST_VERIFY_TOKEN:SUCCESS\") {\n          var token = action.data.token;\n          socket = io(apiConfig.baseUrl.replace(\"/api/\", \"\"), {\n            forceNode: true,\n            transportOptions: {\n              polling: {\n                extraHeaders: {\n                  \"Access-Control-Allow-Origin\": \"*\",\n                  authorization: token\n                }\n              }\n            }\n          });\n          socket.on(\"connected\", function (data) {\n            console.log(\"Socket connected\");\n          });\n          socket.on(\"unauthorized\", function (data) {\n            console.log(\"Socket disconnected\");\n          });\n          socket.on(\"authenticated\", function (data) {\n            console.log(\"Socket authenticated\");\n          });\n          socket.on(\"message\", function (data) {\n            if (data.newConv) {\n              store.dispatch({\n                type: \"RECEIVE_CONVERSATION\",\n                data: res.conversation,\n                receivedAt: new Date()\n              });\n            } else {\n              store.dispatch(_objectSpread({\n                type: \"RECEIVE_MESSAGE\"\n              }, data, {\n                receivedAt: new Date()\n              }));\n            }\n          });\n        }\n\n        if (socket) {\n          if (action.type.substring(0, 6) === \"SOCKET\") {\n            socket.emit(action.event, action.payload);\n          }\n\n          if (action.type === \"REQUEST_LOG_OUT:SUCCESS\") {\n            socket.disconnect();\n            console.log(\"socket disconnected\");\n          }\n        }\n\n        return next(action);\n      };\n    };\n  };\n};\nexport var axiosMiddleware = function axiosMiddleware(store) {\n  return function (next) {\n    return function (action) {\n      if (action.type.substring(0, 7) === \"REQUEST\" && action.type.includes(\":\") === false) {\n        var https;\n\n        if (action.type.substring(0, 14) === \"REQUEST_UPLOAD\") {\n          https = axios.create({\n            baseURL: apiConfig.baseUrl,\n            timeout: 3000,\n            headers: {\n              accept: \"application/json\",\n              \"Access-Control-Allow-Origin\": \"*\",\n              \"Content-Type\": \"multipart/form-data\",\n              Authorization: \"Bearer \" + store.getState().auth.token\n            }\n          });\n        } else {\n          https = axios.create({\n            baseURL: apiConfig.baseUrl,\n            timeout: 3000,\n            headers: {\n              \"Access-Control-Allow-Origin\": \"*\",\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + store.getState().auth.token\n            }\n          });\n        }\n\n        var request = new Promise(function (resolve, reject) {\n          var res;\n\n          switch (action.method) {\n            case \"GET\":\n              res = https.get(action.route);\n              return resolve(res);\n\n            case \"POST\":\n              res = https.post(action.route, action.payload);\n              return resolve(res);\n\n            case \"DELETE\":\n              res = https.delete(action.route, action.payload);\n              return resolve(res);\n\n            case \"PATCH\":\n              res = https.patch(action.route, action.payload);\n              return resolve(res);\n\n            default:\n              return;\n          }\n        });\n        request.then(function (res) {\n          if (action.successNotification) {\n            store.dispatch(showOverlay({\n              timeout: 3000,\n              redirect: action.successNotification.redirect,\n              dispatchCallback: action.successNotification.dispatchCallback,\n              notification: {\n                variant: \"success\",\n                message: action.successNotification.message\n              }\n            }));\n          }\n\n          return store.dispatch({\n            type: action.type + \":SUCCESS\",\n            data: res.data,\n            receivedAt: new Date()\n          });\n        }).catch(function (err) {\n          var _err$response;\n\n          console.log(err);\n\n          if (action.errorNotification || ((_err$response = err.response) == null ? void 0 : _err$response.data.forceReconnect) === true) {\n            var _err$response2, _err$response3;\n\n            store.dispatch(showOverlay({\n              timeout: 3000,\n              dispatchCallback: ((_err$response2 = err.response) == null ? void 0 : _err$response2.data.forceReconnect) && \"REQUEST_LOG_OUT:SUCCESS\",\n              notification: {\n                variant: \"error\",\n                message: ((_err$response3 = err.response) == null ? void 0 : _err$response3.data.message) || \"Cela n'a pas marché...\"\n              }\n            }));\n          }\n\n          return store.dispatch({\n            type: action.type + \":ERROR\",\n            error: err,\n            receivedAt: new Date()\n          });\n        });\n        return next(action);\n      } else {\n        return next(action);\n      }\n    };\n  };\n};\nexport var dataPreprocessingMiddleware = function dataPreprocessingMiddleware(store) {\n  return function (next) {\n    return function (action) {\n      if (action.type === \"RECEIVE_NEW_CONVERSATION\") {\n        console.log(action.data);\n\n        _.remove();\n      }\n\n      return next(action);\n    };\n  };\n};","map":{"version":3,"sources":["/home/gaetan/Documents/GATE/app/client/src/store/reduxMiddlewares.js"],"names":["io","axios","apiConfig","showOverlay","devMiddleware","store","next","action","console","log","type","socketMiddleware","socket","token","data","baseUrl","replace","forceNode","transportOptions","polling","extraHeaders","authorization","on","newConv","dispatch","res","conversation","receivedAt","Date","substring","emit","event","payload","disconnect","axiosMiddleware","includes","https","create","baseURL","timeout","headers","accept","Authorization","getState","auth","request","Promise","resolve","reject","method","get","route","post","delete","patch","then","successNotification","redirect","dispatchCallback","notification","variant","message","catch","err","errorNotification","response","forceReconnect","error","dataPreprocessingMiddleware","_","remove"],"mappings":";;;;;;AAAA,OAAOA,EAAP,MAAe,kBAAf;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,SAAT;AACA,SAASC,WAAT;AAEA,OAAO,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,KAAD;AAAA,SAAW,UAACC,IAAD;AAAA,WAAU,UAACC,MAAD,EAAY;AAC5DC,MAAAA,OAAO,CAACC,GAAR,CAAYF,MAAM,CAACG,IAAnB;AACA,aAAOJ,IAAI,CAACC,MAAD,CAAX;AACD,KAHuC;AAAA,GAAX;AAAA,CAAtB;AAKP,OAAO,IAAMI,gBAAgB,GAAG,SAAnBA,gBAAmB,GAAM;AACpC,MAAIC,MAAJ;AACA,SAAO,UAACP,KAAD;AAAA,WAAW,UAACC,IAAD;AAAA,aAAU,UAACC,MAAD,EAAY;AACtC,YACEA,MAAM,CAACG,IAAP,KAAgB,wBAAhB,IACAH,MAAM,CAACG,IAAP,KAAgB,yBADhB,IAEAH,MAAM,CAACG,IAAP,KAAgB,8BAHlB,EAIE;AAAA,cACQG,KADR,GACkBN,MAAM,CAACO,IADzB,CACQD,KADR;AAEAD,UAAAA,MAAM,GAAGZ,EAAE,CAACE,SAAS,CAACa,OAAV,CAAkBC,OAAlB,CAA0B,OAA1B,EAAmC,EAAnC,CAAD,EAAyC;AAClDC,YAAAA,SAAS,EAAE,IADuC;AAElDC,YAAAA,gBAAgB,EAAE;AAChBC,cAAAA,OAAO,EAAE;AACPC,gBAAAA,YAAY,EAAE;AACZ,iDAA+B,GADnB;AAEZC,kBAAAA,aAAa,EAAER;AAFH;AADP;AADO;AAFgC,WAAzC,CAAX;AAWAD,UAAAA,MAAM,CAACU,EAAP,CAAU,WAAV,EAAuB,UAACR,IAAD,EAAU;AAC/BN,YAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACD,WAFD;AAGAG,UAAAA,MAAM,CAACU,EAAP,CAAU,cAAV,EAA0B,UAACR,IAAD,EAAU;AAClCN,YAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACD,WAFD;AAGAG,UAAAA,MAAM,CAACU,EAAP,CAAU,eAAV,EAA2B,UAACR,IAAD,EAAU;AACnCN,YAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACD,WAFD;AAGAG,UAAAA,MAAM,CAACU,EAAP,CAAU,SAAV,EAAqB,UAACR,IAAD,EAAU;AAC7B,gBAAIA,IAAI,CAACS,OAAT,EAAkB;AAChBlB,cAAAA,KAAK,CAACmB,QAAN,CAAe;AACbd,gBAAAA,IAAI,EAAE,sBADO;AAEbI,gBAAAA,IAAI,EAAEW,GAAG,CAACC,YAFG;AAGbC,gBAAAA,UAAU,EAAE,IAAIC,IAAJ;AAHC,eAAf;AAKD,aAND,MAMO;AACLvB,cAAAA,KAAK,CAACmB,QAAN;AACEd,gBAAAA,IAAI,EAAE;AADR,iBAEKI,IAFL;AAGEa,gBAAAA,UAAU,EAAE,IAAIC,IAAJ;AAHd;AAKD;AACF,WAdD;AAeD;;AACD,YAAIhB,MAAJ,EAAY;AACV,cAAIL,MAAM,CAACG,IAAP,CAAYmB,SAAZ,CAAsB,CAAtB,EAAyB,CAAzB,MAAgC,QAApC,EAA8C;AAC5CjB,YAAAA,MAAM,CAACkB,IAAP,CAAYvB,MAAM,CAACwB,KAAnB,EAA0BxB,MAAM,CAACyB,OAAjC;AACD;;AACD,cAAIzB,MAAM,CAACG,IAAP,KAAgB,yBAApB,EAA+C;AAC7CE,YAAAA,MAAM,CAACqB,UAAP;AACAzB,YAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACD;AACF;;AACD,eAAOH,IAAI,CAACC,MAAD,CAAX;AACD,OArDiB;AAAA,KAAX;AAAA,GAAP;AAsDD,CAxDM;AA0DP,OAAO,IAAM2B,eAAe,GAAG,SAAlBA,eAAkB,CAAC7B,KAAD;AAAA,SAAW,UAACC,IAAD;AAAA,WAAU,UAACC,MAAD,EAAY;AAC9D,UACEA,MAAM,CAACG,IAAP,CAAYmB,SAAZ,CAAsB,CAAtB,EAAyB,CAAzB,MAAgC,SAAhC,IACAtB,MAAM,CAACG,IAAP,CAAYyB,QAAZ,CAAqB,GAArB,MAA8B,KAFhC,EAGE;AACA,YAAIC,KAAJ;;AACA,YAAI7B,MAAM,CAACG,IAAP,CAAYmB,SAAZ,CAAsB,CAAtB,EAAyB,EAAzB,MAAiC,gBAArC,EAAuD;AACrDO,UAAAA,KAAK,GAAGnC,KAAK,CAACoC,MAAN,CAAa;AACnBC,YAAAA,OAAO,EAAEpC,SAAS,CAACa,OADA;AAEnBwB,YAAAA,OAAO,EAAE,IAFU;AAGnBC,YAAAA,OAAO,EAAE;AACPC,cAAAA,MAAM,EAAE,kBADD;AAEP,6CAA+B,GAFxB;AAGP,8BAAgB,qBAHT;AAIPC,cAAAA,aAAa,cAAYrC,KAAK,CAACsC,QAAN,GAAiBC,IAAjB,CAAsB/B;AAJxC;AAHU,WAAb,CAAR;AAUD,SAXD,MAWO;AACLuB,UAAAA,KAAK,GAAGnC,KAAK,CAACoC,MAAN,CAAa;AACnBC,YAAAA,OAAO,EAAEpC,SAAS,CAACa,OADA;AAEnBwB,YAAAA,OAAO,EAAE,IAFU;AAGnBC,YAAAA,OAAO,EAAE;AACP,6CAA+B,GADxB;AAEP,8BAAgB,kBAFT;AAGPE,cAAAA,aAAa,cAAYrC,KAAK,CAACsC,QAAN,GAAiBC,IAAjB,CAAsB/B;AAHxC;AAHU,WAAb,CAAR;AASD;;AACD,YAAMgC,OAAO,GAAG,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACrD,cAAIvB,GAAJ;;AAEA,kBAAQlB,MAAM,CAAC0C,MAAf;AACE,iBAAK,KAAL;AACExB,cAAAA,GAAG,GAAGW,KAAK,CAACc,GAAN,CAAU3C,MAAM,CAAC4C,KAAjB,CAAN;AACA,qBAAOJ,OAAO,CAACtB,GAAD,CAAd;;AACF,iBAAK,MAAL;AACEA,cAAAA,GAAG,GAAGW,KAAK,CAACgB,IAAN,CAAW7C,MAAM,CAAC4C,KAAlB,EAAyB5C,MAAM,CAACyB,OAAhC,CAAN;AACA,qBAAOe,OAAO,CAACtB,GAAD,CAAd;;AACF,iBAAK,QAAL;AACEA,cAAAA,GAAG,GAAGW,KAAK,CAACiB,MAAN,CAAa9C,MAAM,CAAC4C,KAApB,EAA2B5C,MAAM,CAACyB,OAAlC,CAAN;AACA,qBAAOe,OAAO,CAACtB,GAAD,CAAd;;AACF,iBAAK,OAAL;AACEA,cAAAA,GAAG,GAAGW,KAAK,CAACkB,KAAN,CAAY/C,MAAM,CAAC4C,KAAnB,EAA0B5C,MAAM,CAACyB,OAAjC,CAAN;AACA,qBAAOe,OAAO,CAACtB,GAAD,CAAd;;AACF;AACE;AAdJ;AAgBD,SAnBe,CAAhB;AAoBAoB,QAAAA,OAAO,CACJU,IADH,CACQ,UAAC9B,GAAD,EAAS;AACb,cAAIlB,MAAM,CAACiD,mBAAX,EAAgC;AAC9BnD,YAAAA,KAAK,CAACmB,QAAN,CACErB,WAAW,CAAC;AACVoC,cAAAA,OAAO,EAAE,IADC;AAEVkB,cAAAA,QAAQ,EAAElD,MAAM,CAACiD,mBAAP,CAA2BC,QAF3B;AAGVC,cAAAA,gBAAgB,EAAEnD,MAAM,CAACiD,mBAAP,CAA2BE,gBAHnC;AAIVC,cAAAA,YAAY,EAAE;AACZC,gBAAAA,OAAO,EAAE,SADG;AAEZC,gBAAAA,OAAO,EAAEtD,MAAM,CAACiD,mBAAP,CAA2BK;AAFxB;AAJJ,aAAD,CADb;AAWD;;AACD,iBAAOxD,KAAK,CAACmB,QAAN,CAAe;AACpBd,YAAAA,IAAI,EAAKH,MAAM,CAACG,IAAZ,aADgB;AAEpBI,YAAAA,IAAI,EAAEW,GAAG,CAACX,IAFU;AAGpBa,YAAAA,UAAU,EAAE,IAAIC,IAAJ;AAHQ,WAAf,CAAP;AAKD,SApBH,EAqBGkC,KArBH,CAqBS,UAACC,GAAD,EAAS;AAAA;;AACdvD,UAAAA,OAAO,CAACC,GAAR,CAAYsD,GAAZ;;AACA,cACExD,MAAM,CAACyD,iBAAP,IACA,kBAAAD,GAAG,CAACE,QAAJ,mCAAcnD,IAAd,CAAmBoD,cAAnB,MAAsC,IAFxC,EAGE;AAAA;;AACA7D,YAAAA,KAAK,CAACmB,QAAN,CACErB,WAAW,CAAC;AACVoC,cAAAA,OAAO,EAAE,IADC;AAEVmB,cAAAA,gBAAgB,EACd,mBAAAK,GAAG,CAACE,QAAJ,oCAAcnD,IAAd,CAAmBoD,cAAnB,KAAqC,yBAH7B;AAIVP,cAAAA,YAAY,EAAE;AACZC,gBAAAA,OAAO,EAAE,OADG;AAEZC,gBAAAA,OAAO,EAAE,mBAAAE,GAAG,CAACE,QAAJ,oCAAcnD,IAAd,CAAmB+C,OAAnB,KAA8B;AAF3B;AAJJ,aAAD,CADb;AAWD;;AACD,iBAAOxD,KAAK,CAACmB,QAAN,CAAe;AACpBd,YAAAA,IAAI,EAAKH,MAAM,CAACG,IAAZ,WADgB;AAEpByD,YAAAA,KAAK,EAAEJ,GAFa;AAGpBpC,YAAAA,UAAU,EAAE,IAAIC,IAAJ;AAHQ,WAAf,CAAP;AAKD,SA5CH;AA8CA,eAAOtB,IAAI,CAACC,MAAD,CAAX;AACD,OA9FD,MA8FO;AACL,eAAOD,IAAI,CAACC,MAAD,CAAX;AACD;AACF,KAlGyC;AAAA,GAAX;AAAA,CAAxB;AAoGP,OAAO,IAAM6D,2BAA2B,GAAG,SAA9BA,2BAA8B,CAAC/D,KAAD;AAAA,SAAW,UAACC,IAAD;AAAA,WAAU,UAACC,MAAD,EAAY;AAC1E,UAAIA,MAAM,CAACG,IAAP,KAAgB,0BAApB,EAAgD;AAC9CF,QAAAA,OAAO,CAACC,GAAR,CAAYF,MAAM,CAACO,IAAnB;;AAEAuD,QAAAA,CAAC,CAACC,MAAF;AACD;;AACD,aAAOhE,IAAI,CAACC,MAAD,CAAX;AACD,KAPqD;AAAA,GAAX;AAAA,CAApC","sourcesContent":["import io from \"socket.io-client\";\nimport axios from \"axios\";\nimport { apiConfig } from \"../config\";\nimport { showOverlay } from \"../actions/overlayAction\";\n\nexport const devMiddleware = (store) => (next) => (action) => {\n  console.log(action.type);\n  return next(action);\n};\n\nexport const socketMiddleware = () => {\n  let socket;\n  return (store) => (next) => (action) => {\n    if (\n      action.type === \"REQUEST_LOG_IN:SUCCESS\" ||\n      action.type === \"REQUEST_SIGN_UP:SUCCESS\" ||\n      action.type === \"REQUEST_VERIFY_TOKEN:SUCCESS\"\n    ) {\n      const { token } = action.data;\n      socket = io(apiConfig.baseUrl.replace(\"/api/\", \"\"), {\n        forceNode: true,\n        transportOptions: {\n          polling: {\n            extraHeaders: {\n              \"Access-Control-Allow-Origin\": \"*\",\n              authorization: token,\n            },\n          },\n        },\n      });\n      socket.on(\"connected\", (data) => {\n        console.log(\"Socket connected\");\n      });\n      socket.on(\"unauthorized\", (data) => {\n        console.log(\"Socket disconnected\");\n      });\n      socket.on(\"authenticated\", (data) => {\n        console.log(\"Socket authenticated\");\n      });\n      socket.on(\"message\", (data) => {\n        if (data.newConv) {\n          store.dispatch({\n            type: \"RECEIVE_CONVERSATION\",\n            data: res.conversation,\n            receivedAt: new Date(),\n          });\n        } else {\n          store.dispatch({\n            type: \"RECEIVE_MESSAGE\",\n            ...data,\n            receivedAt: new Date(),\n          });\n        }\n      });\n    }\n    if (socket) {\n      if (action.type.substring(0, 6) === \"SOCKET\") {\n        socket.emit(action.event, action.payload);\n      }\n      if (action.type === \"REQUEST_LOG_OUT:SUCCESS\") {\n        socket.disconnect();\n        console.log(\"socket disconnected\");\n      }\n    }\n    return next(action);\n  };\n};\n\nexport const axiosMiddleware = (store) => (next) => (action) => {\n  if (\n    action.type.substring(0, 7) === \"REQUEST\" &&\n    action.type.includes(\":\") === false\n  ) {\n    let https;\n    if (action.type.substring(0, 14) === \"REQUEST_UPLOAD\") {\n      https = axios.create({\n        baseURL: apiConfig.baseUrl,\n        timeout: 3000,\n        headers: {\n          accept: \"application/json\",\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: `Bearer ${store.getState().auth.token}`,\n        },\n      });\n    } else {\n      https = axios.create({\n        baseURL: apiConfig.baseUrl,\n        timeout: 3000,\n        headers: {\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${store.getState().auth.token}`,\n        },\n      });\n    }\n    const request = new Promise(function (resolve, reject) {\n      let res;\n\n      switch (action.method) {\n        case \"GET\":\n          res = https.get(action.route);\n          return resolve(res);\n        case \"POST\":\n          res = https.post(action.route, action.payload);\n          return resolve(res);\n        case \"DELETE\":\n          res = https.delete(action.route, action.payload);\n          return resolve(res);\n        case \"PATCH\":\n          res = https.patch(action.route, action.payload);\n          return resolve(res);\n        default:\n          return;\n      }\n    });\n    request\n      .then((res) => {\n        if (action.successNotification) {\n          store.dispatch(\n            showOverlay({\n              timeout: 3000,\n              redirect: action.successNotification.redirect,\n              dispatchCallback: action.successNotification.dispatchCallback,\n              notification: {\n                variant: \"success\",\n                message: action.successNotification.message,\n              },\n            })\n          );\n        }\n        return store.dispatch({\n          type: `${action.type}:SUCCESS`,\n          data: res.data,\n          receivedAt: new Date(),\n        });\n      })\n      .catch((err) => {\n        console.log(err);\n        if (\n          action.errorNotification ||\n          err.response?.data.forceReconnect === true\n        ) {\n          store.dispatch(\n            showOverlay({\n              timeout: 3000,\n              dispatchCallback:\n                err.response?.data.forceReconnect && \"REQUEST_LOG_OUT:SUCCESS\",\n              notification: {\n                variant: \"error\",\n                message: err.response?.data.message || \"Cela n'a pas marché...\",\n              },\n            })\n          );\n        }\n        return store.dispatch({\n          type: `${action.type}:ERROR`,\n          error: err,\n          receivedAt: new Date(),\n        });\n      });\n\n    return next(action);\n  } else {\n    return next(action);\n  }\n};\n\nexport const dataPreprocessingMiddleware = (store) => (next) => (action) => {\n  if (action.type === \"RECEIVE_NEW_CONVERSATION\") {\n    console.log(action.data);\n    // action.data should be {conversation: {lsls}}\n    _.remove();\n  }\n  return next(action);\n};\n"]},"metadata":{},"sourceType":"module"}