{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useContext, useState, useEffect } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport { connect } from \"react-redux\";\nimport { ThemeContext, Button, Icon } from \"react-native-elements\";\nimport { sendMessage as _sendMessage, fetchConversation as _fetchConversation } from \"../../actions/chatActions\";\nimport _ from \"lodash\";\n\nvar Message = function Message(_ref) {\n  var message = _ref.message,\n      incoming = _ref.incoming,\n      theme = _ref.theme;\n  return React.createElement(View, {\n    style: {\n      flexDirection: \"row\"\n    }\n  }, !incoming && React.createElement(View, {\n    style: {\n      flex: 1\n    }\n  }), React.createElement(View, {\n    style: {\n      backgroundColor: incoming ? \"white\" : theme.colors.primary,\n      borderTopLeftRadius: incoming ? 10 : 0,\n      borderTopRightRadius: !incoming ? 10 : 0,\n      borderBottomLeftRadius: !incoming ? 10 : 0,\n      borderBottomRightRadius: incoming ? 10 : 0,\n      maxWidth: \"80%\",\n      paddingHorizontal: 8,\n      paddingVertical: 8,\n      marginBottom: 8,\n      marginHorizontal: 8\n    }\n  }, React.createElement(Text, {\n    style: {\n      color: !incoming ? \"white\" : \"black\",\n      textAlign: incoming ? \"left\" : \"right\"\n    }\n  }, message.text)), incoming && React.createElement(View, {\n    style: {\n      flex: 1\n    }\n  }));\n};\n\nvar RoomScreen = function RoomScreen(_ref2) {\n  var chat = _ref2.chat,\n      sendMessage = _ref2.sendMessage,\n      route = _ref2.route,\n      auth = _ref2.auth,\n      fetchConversation = _ref2.fetchConversation;\n  var _id = route.params.conversation._id;\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      newMessage = _useState2[0],\n      setNewMessage = _useState2[1];\n\n  var _useContext = useContext(ThemeContext),\n      theme = _useContext.theme;\n\n  var conversation = chat.conversations.filter(function (conv) {\n    return conv._id === _id;\n  })[0];\n  var interlocutor = conversation.participants.filter(function (participant) {\n    return participant._id !== auth.user._id;\n  })[0];\n  useEffect(function () {\n    function fetchData() {\n      conversation_id && fetchConversation(conversation_id);\n    }\n\n    fetchData();\n  }, []);\n\n  var onSendMessage = function onSendMessage() {\n    if (!newMessage) {\n      return;\n    }\n\n    sendMessage({\n      message: {\n        text: newMessage,\n        sentAt: new Date()\n      },\n      conversation_id: conversation_id\n    });\n    setNewMessage(\"\");\n  };\n\n  return React.createElement(View, {\n    style: {\n      flex: 1,\n      justifyContent: \"space-between\"\n    }\n  }, React.createElement(View, {\n    style: {\n      flexDirection: \"row\"\n    }\n  }, React.createElement(View, {\n    style: {\n      width: 40\n    }\n  }), React.createElement(Text, {\n    style: {\n      top: -50,\n      zIndex: 10,\n      paddingTop: 5,\n      paddingRight: 20,\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      textAlign: \"right\",\n      fontSize: 20,\n      flex: 1\n    }\n  }, _.capitalize(interlocutor.firstname) + \" \" + _.capitalize(interlocutor.lastname))), React.createElement(FlatList, {\n    data: chat.conversations.filter(function (conv) {\n      return conv._id === conversation_id;\n    })[0].messages,\n    renderItem: function renderItem(_ref3) {\n      var item = _ref3.item;\n      return React.createElement(Message, {\n        message: item,\n        incoming: item.sender !== auth.user._id,\n        theme: theme\n      });\n    },\n    keyExtractor: function keyExtractor(item) {\n      return item._id;\n    },\n    inverted: true\n  }), React.createElement(View, {\n    style: {\n      flexDirection: \"row\",\n      backgroundColor: \"white\",\n      paddingVertical: 8,\n      paddingHorizontal: 16,\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      alignContent: \"center\"\n    }\n  }, React.createElement(TextInput, {\n    style: {\n      height: 40,\n      flex: 1\n    },\n    onChangeText: function onChangeText(text) {\n      return setNewMessage(text);\n    },\n    value: newMessage,\n    multiline: true,\n    placeholder: \"Ecrivez votre message ici.\"\n  }), React.createElement(Button, {\n    icon: React.createElement(Icon, {\n      name: \"send\",\n      size: 20,\n      color: newMessage ? theme.colors.primary : theme.colors.grey2\n    }),\n    disabled: !newMessage,\n    type: \"clear\",\n    onPress: function onPress() {\n      return onSendMessage();\n    }\n  })));\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    chat: state.chat,\n    auth: state.auth\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    sendMessage: function sendMessage(message) {\n      return dispatch(_sendMessage(message));\n    },\n    fetchConversation: function fetchConversation(conversation_id) {\n      return dispatch(_fetchConversation(conversation_id));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(RoomScreen);","map":{"version":3,"sources":["/home/gaetan/Documents/GATE/app/frontend/src/components/Messages/MessagesRoomScreen.js"],"names":["React","useContext","useState","useEffect","connect","ThemeContext","Button","Icon","sendMessage","fetchConversation","_","Message","message","incoming","theme","flexDirection","flex","backgroundColor","colors","primary","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","maxWidth","paddingHorizontal","paddingVertical","marginBottom","marginHorizontal","color","textAlign","text","RoomScreen","chat","route","auth","_id","params","conversation","newMessage","setNewMessage","conversations","filter","conv","interlocutor","participants","participant","user","fetchData","conversation_id","onSendMessage","sentAt","Date","justifyContent","width","top","zIndex","paddingTop","paddingRight","alignItems","fontSize","capitalize","firstname","lastname","messages","item","sender","alignContent","height","grey2","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,UAAhB,EAA4BC,QAA5B,EAAsCC,SAAtC,QAAuD,OAAvD;;;;;AAEA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,YAAT,EAAuBC,MAAvB,EAA+BC,IAA/B,QAA2C,uBAA3C;AACA,SAASC,WAAW,IAAXA,YAAT,EAAsBC,iBAAiB,IAAjBA,kBAAtB;AACA,OAAOC,CAAP,MAAc,QAAd;;AAEA,IAAMC,OAAO,GAAG,SAAVA,OAAU,OAAkC;AAAA,MAA/BC,OAA+B,QAA/BA,OAA+B;AAAA,MAAtBC,QAAsB,QAAtBA,QAAsB;AAAA,MAAZC,KAAY,QAAZA,KAAY;AAChD,SACE,oBAAC,IAAD;AACE,IAAA,KAAK,EAAE;AACLC,MAAAA,aAAa,EAAE;AADV;AADT,KAKG,CAACF,QAAD,IAAa,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAAEG,MAAAA,IAAI,EAAE;AAAR;AAAb,IALhB,EAME,oBAAC,IAAD;AACE,IAAA,KAAK,EAAE;AACLC,MAAAA,eAAe,EAAEJ,QAAQ,GAAG,OAAH,GAAaC,KAAK,CAACI,MAAN,CAAaC,OAD9C;AAELC,MAAAA,mBAAmB,EAAEP,QAAQ,GAAG,EAAH,GAAQ,CAFhC;AAGLQ,MAAAA,oBAAoB,EAAE,CAACR,QAAD,GAAY,EAAZ,GAAiB,CAHlC;AAILS,MAAAA,sBAAsB,EAAE,CAACT,QAAD,GAAY,EAAZ,GAAiB,CAJpC;AAKLU,MAAAA,uBAAuB,EAAEV,QAAQ,GAAG,EAAH,GAAQ,CALpC;AAMLW,MAAAA,QAAQ,EAAE,KANL;AAOLC,MAAAA,iBAAiB,EAAE,CAPd;AAQLC,MAAAA,eAAe,EAAE,CARZ;AASLC,MAAAA,YAAY,EAAE,CATT;AAULC,MAAAA,gBAAgB,EAAE;AAVb;AADT,KAcE,oBAAC,IAAD;AACE,IAAA,KAAK,EAAE;AACLC,MAAAA,KAAK,EAAE,CAAChB,QAAD,GAAY,OAAZ,GAAsB,OADxB;AAELiB,MAAAA,SAAS,EAAEjB,QAAQ,GAAG,MAAH,GAAY;AAF1B;AADT,KAMGD,OAAO,CAACmB,IANX,CAdF,CANF,EA6BGlB,QAAQ,IAAI,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAAEG,MAAAA,IAAI,EAAE;AAAR;AAAb,IA7Bf,CADF;AAiCD,CAlCD;;AAoCA,IAAMgB,UAAU,GAAG,SAAbA,UAAa,QAA2D;AAAA,MAAxDC,IAAwD,SAAxDA,IAAwD;AAAA,MAAlDzB,WAAkD,SAAlDA,WAAkD;AAAA,MAArC0B,KAAqC,SAArCA,KAAqC;AAAA,MAA9BC,IAA8B,SAA9BA,IAA8B;AAAA,MAAxB1B,iBAAwB,SAAxBA,iBAAwB;AAAA,MACpE2B,GADoE,GAC5DF,KAAK,CAACG,MAAN,CAAaC,YAD+C,CACpEF,GADoE;;AAAA,kBAExClC,QAAQ,CAAC,EAAD,CAFgC;AAAA;AAAA,MAErEqC,UAFqE;AAAA,MAEzDC,aAFyD;;AAAA,oBAG1DvC,UAAU,CAACI,YAAD,CAHgD;AAAA,MAGpES,KAHoE,eAGpEA,KAHoE;;AAI5E,MAAMwB,YAAY,GAAGL,IAAI,CAACQ,aAAL,CAAmBC,MAAnB,CAA0B,UAAAC,IAAI;AAAA,WAAIA,IAAI,CAACP,GAAL,KAAaA,GAAjB;AAAA,GAA9B,EAAoD,CAApD,CAArB;AACA,MAAMQ,YAAY,GAAGN,YAAY,CAACO,YAAb,CAA0BH,MAA1B,CACnB,UAAAI,WAAW;AAAA,WAAIA,WAAW,CAACV,GAAZ,KAAoBD,IAAI,CAACY,IAAL,CAAUX,GAAlC;AAAA,GADQ,EAEnB,CAFmB,CAArB;AAIAjC,EAAAA,SAAS,CAAC,YAAM;AACd,aAAS6C,SAAT,GAAqB;AACnBC,MAAAA,eAAe,IAAIxC,iBAAiB,CAACwC,eAAD,CAApC;AACD;;AACDD,IAAAA,SAAS;AACV,GALQ,EAKN,EALM,CAAT;;AAOA,MAAME,aAAa,GAAG,SAAhBA,aAAgB,GAAM;AAC1B,QAAI,CAACX,UAAL,EAAiB;AACf;AACD;;AACD/B,IAAAA,WAAW,CAAC;AACVI,MAAAA,OAAO,EAAE;AACPmB,QAAAA,IAAI,EAAEQ,UADC;AAEPY,QAAAA,MAAM,EAAE,IAAIC,IAAJ;AAFD,OADC;AAKVH,MAAAA,eAAe,EAAfA;AALU,KAAD,CAAX;AAOAT,IAAAA,aAAa,CAAC,EAAD,CAAb;AACD,GAZD;;AAcA,SACE,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAAExB,MAAAA,IAAI,EAAE,CAAR;AAAWqC,MAAAA,cAAc,EAAE;AAA3B;AAAb,KACE,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAAEtC,MAAAA,aAAa,EAAE;AAAjB;AAAb,KACE,oBAAC,IAAD;AAAM,IAAA,KAAK,EAAE;AAAEuC,MAAAA,KAAK,EAAE;AAAT;AAAb,IADF,EAEE,oBAAC,IAAD;AACE,IAAA,KAAK,EAAE;AACLC,MAAAA,GAAG,EAAE,CAAC,EADD;AAELC,MAAAA,MAAM,EAAE,EAFH;AAGLC,MAAAA,UAAU,EAAE,CAHP;AAILC,MAAAA,YAAY,EAAE,EAJT;AAKLC,MAAAA,UAAU,EAAE,QALP;AAMLN,MAAAA,cAAc,EAAE,QANX;AAOLvB,MAAAA,SAAS,EAAE,OAPN;AAQL8B,MAAAA,QAAQ,EAAE,EARL;AASL5C,MAAAA,IAAI,EAAE;AATD;AADT,KAaGN,CAAC,CAACmD,UAAF,CAAajB,YAAY,CAACkB,SAA1B,IACC,GADD,GAECpD,CAAC,CAACmD,UAAF,CAAajB,YAAY,CAACmB,QAA1B,CAfJ,CAFF,CADF,EAqBE,oBAAC,QAAD;AACE,IAAA,IAAI,EACF9B,IAAI,CAACQ,aAAL,CAAmBC,MAAnB,CAA0B,UAAAC,IAAI;AAAA,aAAIA,IAAI,CAACP,GAAL,KAAaa,eAAjB;AAAA,KAA9B,EAAgE,CAAhE,EACGe,QAHP;AAKE,IAAA,UAAU,EAAE;AAAA,UAAGC,IAAH,SAAGA,IAAH;AAAA,aACV,oBAAC,OAAD;AACE,QAAA,OAAO,EAAEA,IADX;AAEE,QAAA,QAAQ,EAAEA,IAAI,CAACC,MAAL,KAAgB/B,IAAI,CAACY,IAAL,CAAUX,GAFtC;AAGE,QAAA,KAAK,EAAEtB;AAHT,QADU;AAAA,KALd;AAYE,IAAA,YAAY,EAAE,sBAAAmD,IAAI;AAAA,aAAIA,IAAI,CAAC7B,GAAT;AAAA,KAZpB;AAaE,IAAA,QAAQ,EAAE;AAbZ,IArBF,EAoCE,oBAAC,IAAD;AACE,IAAA,KAAK,EAAE;AACLrB,MAAAA,aAAa,EAAE,KADV;AAELE,MAAAA,eAAe,EAAE,OAFZ;AAGLS,MAAAA,eAAe,EAAE,CAHZ;AAILD,MAAAA,iBAAiB,EAAE,EAJd;AAKLkC,MAAAA,UAAU,EAAE,QALP;AAMLN,MAAAA,cAAc,EAAE,QANX;AAOLc,MAAAA,YAAY,EAAE;AAPT;AADT,KAWE,oBAAC,SAAD;AACE,IAAA,KAAK,EAAE;AACLC,MAAAA,MAAM,EAAE,EADH;AAELpD,MAAAA,IAAI,EAAE;AAFD,KADT;AAKE,IAAA,YAAY,EAAE,sBAAAe,IAAI;AAAA,aAAIS,aAAa,CAACT,IAAD,CAAjB;AAAA,KALpB;AAME,IAAA,KAAK,EAAEQ,UANT;AAOE,IAAA,SAAS,MAPX;AAQE,IAAA,WAAW,EAAC;AARd,IAXF,EAqBE,oBAAC,MAAD;AACE,IAAA,IAAI,EACF,oBAAC,IAAD;AACE,MAAA,IAAI,EAAC,MADP;AAEE,MAAA,IAAI,EAAE,EAFR;AAGE,MAAA,KAAK,EAAEA,UAAU,GAAGzB,KAAK,CAACI,MAAN,CAAaC,OAAhB,GAA0BL,KAAK,CAACI,MAAN,CAAamD;AAH1D,MAFJ;AAQE,IAAA,QAAQ,EAAE,CAAC9B,UARb;AASE,IAAA,IAAI,EAAC,OATP;AAUE,IAAA,OAAO,EAAE;AAAA,aAAMW,aAAa,EAAnB;AAAA;AAVX,IArBF,CApCF,CADF;AAyED,CAvGD;;AAyGA,IAAMoB,eAAe,GAAG,SAAlBA,eAAkB,CAAAC,KAAK,EAAI;AAC/B,SAAO;AACLtC,IAAAA,IAAI,EAAEsC,KAAK,CAACtC,IADP;AAELE,IAAAA,IAAI,EAAEoC,KAAK,CAACpC;AAFP,GAAP;AAID,CALD;;AAOA,IAAMqC,kBAAkB,GAAG,SAArBA,kBAAqB,CAAAC,QAAQ,EAAI;AACrC,SAAO;AACLjE,IAAAA,WAAW,EAAE,qBAAAI,OAAO;AAAA,aAAI6D,QAAQ,CAACjE,YAAW,CAACI,OAAD,CAAZ,CAAZ;AAAA,KADf;AAELH,IAAAA,iBAAiB,EAAE,2BAAAwC,eAAe;AAAA,aAChCwB,QAAQ,CAAChE,kBAAiB,CAACwC,eAAD,CAAlB,CADwB;AAAA;AAF7B,GAAP;AAKD,CAND;;AAQA,eAAe7C,OAAO,CAACkE,eAAD,EAAkBE,kBAAlB,CAAP,CAA6CxC,UAA7C,CAAf","sourcesContent":["import React, { useContext, useState, useEffect } from \"react\";\nimport { View, Text, TextInput, FlatList } from \"react-native\";\nimport { connect } from \"react-redux\";\nimport { ThemeContext, Button, Icon } from \"react-native-elements\";\nimport { sendMessage, fetchConversation } from \"../../actions/chatActions\";\nimport _ from \"lodash\";\n\nconst Message = ({ message, incoming, theme }) => {\n  return (\n    <View\n      style={{\n        flexDirection: \"row\"\n      }}\n    >\n      {!incoming && <View style={{ flex: 1 }}></View>}\n      <View\n        style={{\n          backgroundColor: incoming ? \"white\" : theme.colors.primary,\n          borderTopLeftRadius: incoming ? 10 : 0,\n          borderTopRightRadius: !incoming ? 10 : 0,\n          borderBottomLeftRadius: !incoming ? 10 : 0,\n          borderBottomRightRadius: incoming ? 10 : 0,\n          maxWidth: \"80%\",\n          paddingHorizontal: 8,\n          paddingVertical: 8,\n          marginBottom: 8,\n          marginHorizontal: 8\n        }}\n      >\n        <Text\n          style={{\n            color: !incoming ? \"white\" : \"black\",\n            textAlign: incoming ? \"left\" : \"right\"\n          }}\n        >\n          {message.text}\n        </Text>\n      </View>\n      {incoming && <View style={{ flex: 1 }}></View>}\n    </View>\n  );\n};\n\nconst RoomScreen = ({ chat, sendMessage, route, auth, fetchConversation }) => {\n  const { _id } = route.params.conversation;\n  const [newMessage, setNewMessage] = useState(\"\");\n  const { theme } = useContext(ThemeContext);\n  const conversation = chat.conversations.filter(conv => conv._id === _id)[0];\n  const interlocutor = conversation.participants.filter(\n    participant => participant._id !== auth.user._id\n  )[0];\n\n  useEffect(() => {\n    function fetchData() {\n      conversation_id && fetchConversation(conversation_id);\n    }\n    fetchData();\n  }, []);\n\n  const onSendMessage = () => {\n    if (!newMessage) {\n      return;\n    }\n    sendMessage({\n      message: {\n        text: newMessage,\n        sentAt: new Date()\n      },\n      conversation_id\n    });\n    setNewMessage(\"\");\n  };\n\n  return (\n    <View style={{ flex: 1, justifyContent: \"space-between\" }}>\n      <View style={{ flexDirection: \"row\" }}>\n        <View style={{ width: 40 }}></View>\n        <Text\n          style={{\n            top: -50,\n            zIndex: 10,\n            paddingTop: 5,\n            paddingRight: 20,\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            textAlign: \"right\",\n            fontSize: 20,\n            flex: 1\n          }}\n        >\n          {_.capitalize(interlocutor.firstname) +\n            \" \" +\n            _.capitalize(interlocutor.lastname)}\n        </Text>\n      </View>\n      <FlatList\n        data={\n          chat.conversations.filter(conv => conv._id === conversation_id)[0]\n            .messages\n        }\n        renderItem={({ item }) => (\n          <Message\n            message={item}\n            incoming={item.sender !== auth.user._id}\n            theme={theme}\n          />\n        )}\n        keyExtractor={item => item._id}\n        inverted={true}\n      />\n      <View\n        style={{\n          flexDirection: \"row\",\n          backgroundColor: \"white\",\n          paddingVertical: 8,\n          paddingHorizontal: 16,\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          alignContent: \"center\"\n        }}\n      >\n        <TextInput\n          style={{\n            height: 40,\n            flex: 1\n          }}\n          onChangeText={text => setNewMessage(text)}\n          value={newMessage}\n          multiline\n          placeholder=\"Ecrivez votre message ici.\"\n        />\n        <Button\n          icon={\n            <Icon\n              name=\"send\"\n              size={20}\n              color={newMessage ? theme.colors.primary : theme.colors.grey2}\n            />\n          }\n          disabled={!newMessage}\n          type=\"clear\"\n          onPress={() => onSendMessage()}\n        />\n      </View>\n    </View>\n  );\n};\n\nconst mapStateToProps = state => {\n  return {\n    chat: state.chat,\n    auth: state.auth\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    sendMessage: message => dispatch(sendMessage(message)),\n    fetchConversation: conversation_id =>\n      dispatch(fetchConversation(conversation_id))\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(RoomScreen);\n"]},"metadata":{},"sourceType":"module"}