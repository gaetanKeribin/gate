{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useState,useEffect,useCallback,useContext}from\"react\";import{connect}from\"react-redux\";import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import FlatList from\"react-native-web/dist/exports/FlatList\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import RefreshControl from\"react-native-web/dist/exports/RefreshControl\";import TextInput from\"react-native-web/dist/exports/TextInput\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import{SearchBar,Avatar,ThemeContext,Button,Icon,Overlay}from\"react-native-elements\";import _ from\"lodash\";import\"moment/locale/fr\";import moment from\"moment\";import{fetchUsers as _fetchUsers}from\"../actions/usersActions\";import{fetchConversations as _fetchConversations,sendMessage as _sendMessage,deleteConversation as _deleteConversation}from\"../actions/chatActions\";var SearchResultItem=function SearchResultItem(_ref){var _item$avatar;var item=_ref.item,theme=_ref.theme,onSendMessage=_ref.onSendMessage,navigation=_ref.navigation,chat=_ref.chat;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showMessageForm=_useState2[0],setShowMessageForm=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),newMessage=_useState4[0],setNewMessage=_useState4[1];return React.createElement(TouchableOpacity,{onPress:chat.interlocutorsIds.includes(item._id)?function(){return navigation.navigate(\"Room\",{conversation_id:chat.convIdsWithPartsIds.filter(function(element){return element.participants.includes(item._id)===true;}).filter(function(conv){return conv.participants.length===2;})[0]._id});}:function(){return setShowMessageForm(true);}},React.createElement(View,{style:{flexDirection:\"row\",alignItems:\"center\",paddingVertical:4,paddingHorizontal:8,borderBottomColor:theme.colors.grey5,borderBottomWidth:1}},React.createElement(View,{style:{alignContent:\"center\",justifyContent:\"center\",alignItems:\"center\",marginRight:12}},item.avatar?React.createElement(Avatar,{source:{uri:\"http://10.0.2.2:8005/api/files/avatar/\"+((_item$avatar=item.avatar)==null?void 0:_item$avatar.filename)},size:\"small\"}):React.createElement(Avatar,{size:\"small\",title:item.firstname[0].concat(item.lastname[0]).toUpperCase()})),React.createElement(Text,{style:{paddingLeft:12}},_.capitalize(item.firstname)+\" \"+_.capitalize(item.lastname))),React.createElement(Overlay,{isVisible:showMessageForm,width:\"auto\",containerStyle:{},height:\"auto\",overlayStyle:{borderRadius:6},onBackdropPress:function onBackdropPress(){setShowMessageForm(false);setNewMessage(null);}},React.createElement(View,{style:{}},React.createElement(Text,{style:{textAlign:\"center\"}},_.capitalize(item.firstname)+\" \"+_.capitalize(item.lastname)),React.createElement(View,{style:{flexDirection:\"row\",backgroundColor:\"white\",alignItems:\"center\",justifyContent:\"center\",alignContent:\"center\",marginTop:8}},React.createElement(TextInput,{value:newMessage,multiline:true,placeholder:\"Ecrivez ici.\",placeholderTextColor:\"grey\",width:250,onChangeText:function onChangeText(text){return setNewMessage(text);},style:{backgroundColor:theme.colors.grey5,borderColor:theme.colors.grey4,borderWidth:1,borderRadius:5,paddingVertical:2,paddingHorizontal:4,maxHeight:80}}),React.createElement(Button,{containerStyle:{height:30},icon:React.createElement(Icon,{name:\"send\",size:20,color:newMessage?theme.colors.primary:theme.colors.grey2}),disabled:!newMessage,type:\"clear\",onPress:function onPress(){onSendMessage(newMessage,item._id);setNewMessage(\"\");setShowMessageForm(false);}})))));};var Item=function Item(_ref2){var _participantsArr$0$av;var item=_ref2.item,navigation=_ref2.navigation,auth=_ref2.auth,theme=_ref2.theme,deleteConversation=_ref2.deleteConversation,fetchConversations=_ref2.fetchConversations;var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showActionMenu=_useState6[0],setShowActionMenu=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),deleting=_useState8[0],setDeleting=_useState8[1];var participantsArr=item.participants.filter(function(participant){return participant._id!==auth.user._id;});var listParticipants=function listParticipants(item){if(participantsArr.length>1){var participantsList=participantsArr.map(function(participant){return participant.firstname;});return participantsList.toString().replace(\",\",\", \");}else{return _.capitalize(participantsArr[0].firstname).concat(\" \",_.capitalize(participantsArr[0].lastname));}};var participants=listParticipants(item);return React.createElement(TouchableOpacity,{onPress:function onPress(){return navigation.navigate(\"Room\",{conversation_id:item._id});}},React.createElement(View,{style:{paddingHorizontal:8,paddingVertical:8,borderBottomColor:\"white\",borderBottomWidth:3,backgroundColor:\"white\"}},React.createElement(View,{style:{flexDirection:\"row\"}},React.createElement(View,{style:{alignContent:\"center\",justifyContent:\"center\",paddingRight:8}},participantsArr[0].avatar?React.createElement(Avatar,{source:{uri:\"http://10.0.2.2:8005/api/files/avatar/\"+((_participantsArr$0$av=participantsArr[0].avatar)==null?void 0:_participantsArr$0$av.filename)},size:\"medium\"}):React.createElement(Avatar,{size:\"medium\",title:participantsArr[0].firstname[0].concat(participantsArr[0].lastname[0]).toUpperCase()})),React.createElement(View,{style:{flex:1,justifyContent:\"space-between\"}},React.createElement(View,{style:{flexDirection:\"row\",flex:1,justifyContent:\"space-between\"}},React.createElement(Text,{style:{textAlignVertical:\"bottom\",fontSize:16,fontWeight:\"bold\"}},participants),React.createElement(Text,{color:\"grey\",style:{color:\"grey\",fontSize:10,textAlignVertical:\"bottom\"}},_.capitalize(moment(item.lastMessage.sentAt).locale(\"fr\").fromNow()))),React.createElement(View,{style:{flexDirection:\"row\"}},React.createElement(View,{style:{alignContent:\"center\",justifyContent:\"center\"}},item.lastMessage.sender===auth.user._id?React.createElement(Icon,{name:\"arrow-top-right\",color:theme.colors.grey1,size:14}):React.createElement(Icon,{name:\"arrow-bottom-left\",color:theme.colors.grey3,size:14})),React.createElement(Text,{style:{textAlignVertical:\"center\",fontSize:14,flex:1}},item.lastMessage.text),React.createElement(View,{style:{alignContent:\"center\",justifyContent:\"center\"}},React.createElement(Icon,{name:\"dots-horizontal\",style:{alignSelf:\"flex-end\"},onPress:function onPress(){return setShowActionMenu(true);}})),React.createElement(Overlay,{isVisible:showActionMenu,onBackdropPress:function onBackdropPress(){return setShowActionMenu(false);},height:\"auto\"},React.createElement(Button,{title:\"Supprimer la conversation\",loading:deleting,onPress:function _callee(){return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setDeleting(true);_context.next=3;return _regeneratorRuntime.awrap(deleteConversation(item._id));case 3:setDeleting(false);setShowActionMenu(false);fetchConversations();case 6:case\"end\":return _context.stop();}}},null,null,null,Promise);}})))))));};var ChatLobbyScreen=function ChatLobbyScreen(_ref3){var navigation=_ref3.navigation,fetchConversations=_ref3.fetchConversations,fetchUsers=_ref3.fetchUsers,chat=_ref3.chat,users=_ref3.users,auth=_ref3.auth,sendMessage=_ref3.sendMessage,deleteConversation=_ref3.deleteConversation;var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),refreshing=_useState10[0],setRefreshing=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),search=_useState12[0],setSearch=_useState12[1];var _useContext=useContext(ThemeContext),theme=_useContext.theme;useEffect(function(){function fetchData(){fetchConversations();fetchUsers();}fetchData();},[]);var onRefresh=useCallback(function(){setRefreshing(true);fetchConversations();setRefreshing(false);},[refreshing]);var searchProcess=function searchProcess(){var searchResults=[];users.users.forEach(function(user){if(user._id!==auth.user._id){if(user.firstname.includes(search.toLowerCase())===true||user.lastname.includes(search.toLowerCase())){searchResults.push(user);}}});return searchResults;};var onSendMessage=function onSendMessage(newMessage,recipient){return _regeneratorRuntime.async(function onSendMessage$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(newMessage){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:_context2.next=4;return _regeneratorRuntime.awrap(sendMessage({message:{text:newMessage,sentAt:new Date()},recipients:[recipient]}));case 4:setSearch(null);case 5:case\"end\":return _context2.stop();}}},null,null,null,Promise);};return React.createElement(View,{style:{flex:1}},React.createElement(View,{style:{backgroundColor:\"white\",paddingVertical:4}},React.createElement(SearchBar,{placeholder:\"Chercher un alumni ici...\",onChangeText:setSearch,value:search,lightTheme:true,platform:\"android\",containerStyle:{paddingTop:0,height:40}}),users.isLoaded&&React.createElement(FlatList,{style:{},data:search&&searchProcess(),renderItem:function renderItem(_ref4){var item=_ref4.item;return React.createElement(SearchResultItem,{item:item,theme:theme,onSendMessage:onSendMessage,chat:chat,navigation:navigation});},keyExtractor:function keyExtractor(item){return item._id;}}),!users.isLoaded&&React.createElement(View,{style:{flex:1,alignContent:\"center\",justifyContent:\"center\"}},React.createElement(ActivityIndicator,{size:\"small\"}))),chat.isLoaded?chat.conversations.length>0?React.createElement(FlatList,{style:{},data:chat.conversations,renderItem:function renderItem(_ref5){var item=_ref5.item;return React.createElement(Item,{item:item,auth:auth,navigation:navigation,theme:theme,deleteConversation:deleteConversation,fetchConversations:fetchConversations});},keyExtractor:function keyExtractor(item){return item._id;},refreshControl:React.createElement(RefreshControl,{refreshing:refreshing,onRefresh:onRefresh})}):React.createElement(View,{style:{flex:1,alignContent:\"center\",justifyContent:\"center\"}},React.createElement(Text,{style:{textAlign:\"center\",color:theme.colors.grey3}},\"Aucune conversation\"),React.createElement(Button,{title:\"Rafraichir\",type:\"clear\",onPress:fetchConversations})):React.createElement(View,{style:{flex:1,alignContent:\"center\",justifyContent:\"center\"}},React.createElement(ActivityIndicator,{size:\"large\"})));};var mapStateToProps=function mapStateToProps(state){return{auth:state.auth,chat:state.chat,users:state.users};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{fetchConversations:function fetchConversations(){return dispatch(_fetchConversations());},fetchUsers:function fetchUsers(){return dispatch(_fetchUsers());},sendMessage:function sendMessage(message){return dispatch(_sendMessage(message));},deleteConversation:function deleteConversation(conversation_id){return dispatch(_deleteConversation(conversation_id));}};};export default connect(mapStateToProps,mapDispatchToProps)(ChatLobbyScreen);","map":{"version":3,"sources":["/home/gaetan/Documents/GATE/app/frontend/src/components/MessagesLobbyScreen.js"],"names":["React","useState","useEffect","useCallback","useContext","connect","SearchBar","Avatar","ThemeContext","Button","Icon","Overlay","_","moment","fetchUsers","fetchConversations","sendMessage","deleteConversation","SearchResultItem","item","theme","onSendMessage","navigation","chat","showMessageForm","setShowMessageForm","newMessage","setNewMessage","interlocutorsIds","includes","_id","navigate","conversation_id","convIdsWithPartsIds","filter","element","participants","conv","length","flexDirection","alignItems","paddingVertical","paddingHorizontal","borderBottomColor","colors","grey5","borderBottomWidth","alignContent","justifyContent","marginRight","avatar","uri","filename","firstname","concat","lastname","toUpperCase","paddingLeft","capitalize","borderRadius","textAlign","backgroundColor","marginTop","text","borderColor","grey4","borderWidth","maxHeight","height","primary","grey2","Item","auth","showActionMenu","setShowActionMenu","deleting","setDeleting","participantsArr","participant","user","listParticipants","participantsList","map","toString","replace","paddingRight","flex","textAlignVertical","fontSize","fontWeight","color","lastMessage","sentAt","locale","fromNow","sender","grey1","grey3","alignSelf","ChatLobbyScreen","users","refreshing","setRefreshing","search","setSearch","fetchData","onRefresh","searchProcess","searchResults","forEach","toLowerCase","push","recipient","message","Date","recipients","paddingTop","isLoaded","conversations","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback, useContext } from \"react\";\nimport { connect } from \"react-redux\";\nimport {\n  View,\n  Text,\n  StyleSheet,\n  ActivityIndicator,\n  FlatList,\n  TouchableOpacity,\n  RefreshControl,\n  TextInput,\n  Dimensions\n} from \"react-native\";\nimport {\n  SearchBar,\n  Avatar,\n  ThemeContext,\n  Button,\n  Icon,\n  Overlay\n} from \"react-native-elements\";\nimport _ from \"lodash\";\nimport \"moment/locale/fr\";\nimport moment from \"moment\";\nimport { fetchUsers } from \"../actions/usersActions\";\nimport {\n  fetchConversations,\n  sendMessage,\n  deleteConversation\n} from \"../actions/chatActions\";\n\nconst SearchResultItem = ({ item, theme, onSendMessage, navigation, chat }) => {\n  const [showMessageForm, setShowMessageForm] = useState(false);\n  const [newMessage, setNewMessage] = useState(null);\n\n  return (\n    <TouchableOpacity\n      onPress={\n        chat.interlocutorsIds.includes(item._id)\n          ? () =>\n              navigation.navigate(\"Room\", {\n                conversation_id: chat.convIdsWithPartsIds\n                  .filter(\n                    element => element.participants.includes(item._id) === true\n                  )\n                  .filter(conv => conv.participants.length === 2)[0]._id\n              })\n          : () => setShowMessageForm(true)\n      }\n    >\n      <View\n        style={{\n          flexDirection: \"row\",\n          alignItems: \"center\",\n          paddingVertical: 4,\n          paddingHorizontal: 8,\n          borderBottomColor: theme.colors.grey5,\n          borderBottomWidth: 1\n        }}\n      >\n        <View\n          style={{\n            alignContent: \"center\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            marginRight: 12\n          }}\n        >\n          {item.avatar ? (\n            <Avatar\n              source={{\n                uri: `http://10.0.2.2:8005/api/files/avatar/${item.avatar?.filename}`\n              }}\n              size=\"small\"\n            />\n          ) : (\n            <Avatar\n              size=\"small\"\n              title={item.firstname[0].concat(item.lastname[0]).toUpperCase()}\n            />\n          )}\n        </View>\n        <Text style={{ paddingLeft: 12 }}>\n          {_.capitalize(item.firstname) + \" \" + _.capitalize(item.lastname)}\n        </Text>\n      </View>\n      <Overlay\n        isVisible={showMessageForm}\n        width=\"auto\"\n        containerStyle={{}}\n        height=\"auto\"\n        overlayStyle={{\n          borderRadius: 6\n        }}\n        onBackdropPress={() => {\n          setShowMessageForm(false);\n          setNewMessage(null);\n        }}\n      >\n        <View style={{}}>\n          <Text style={{ textAlign: \"center\" }}>\n            {_.capitalize(item.firstname) + \" \" + _.capitalize(item.lastname)}\n          </Text>\n          <View\n            style={{\n              flexDirection: \"row\",\n              backgroundColor: \"white\",\n              alignItems: \"center\",\n              justifyContent: \"center\",\n              alignContent: \"center\",\n              marginTop: 8\n            }}\n          >\n            <TextInput\n              value={newMessage}\n              multiline\n              placeholder=\"Ecrivez ici.\"\n              placeholderTextColor=\"grey\"\n              width={250}\n              onChangeText={text => setNewMessage(text)}\n              style={{\n                backgroundColor: theme.colors.grey5,\n                borderColor: theme.colors.grey4,\n                borderWidth: 1,\n                borderRadius: 5,\n                paddingVertical: 2,\n                paddingHorizontal: 4,\n                maxHeight: 80\n              }}\n            />\n            <Button\n              containerStyle={{ height: 30 }}\n              icon={\n                <Icon\n                  name=\"send\"\n                  size={20}\n                  color={newMessage ? theme.colors.primary : theme.colors.grey2}\n                />\n              }\n              disabled={!newMessage}\n              type=\"clear\"\n              onPress={() => {\n                onSendMessage(newMessage, item._id);\n                setNewMessage(\"\");\n                setShowMessageForm(false);\n              }}\n            />\n          </View>\n        </View>\n      </Overlay>\n    </TouchableOpacity>\n  );\n};\n\nconst Item = ({\n  item,\n  navigation,\n  auth,\n  theme,\n  deleteConversation,\n  fetchConversations\n}) => {\n  const [showActionMenu, setShowActionMenu] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n  const participantsArr = item.participants.filter(\n    participant => participant._id !== auth.user._id\n  );\n  const listParticipants = item => {\n    if (participantsArr.length > 1) {\n      const participantsList = participantsArr.map(\n        participant => participant.firstname\n      );\n      return participantsList.toString().replace(\",\", \", \");\n    } else {\n      return _.capitalize(participantsArr[0].firstname).concat(\n        \" \",\n        _.capitalize(participantsArr[0].lastname)\n      );\n    }\n  };\n\n  const participants = listParticipants(item);\n\n  return (\n    <TouchableOpacity\n      onPress={() => navigation.navigate(\"Room\", { conversation_id: item._id })}\n    >\n      <View\n        style={{\n          paddingHorizontal: 8,\n          paddingVertical: 8,\n          borderBottomColor: \"white\",\n          borderBottomWidth: 3,\n          backgroundColor: \"white\"\n        }}\n      >\n        <View style={{ flexDirection: \"row\" }}>\n          <View\n            style={{\n              alignContent: \"center\",\n              justifyContent: \"center\",\n              paddingRight: 8\n            }}\n          >\n            {participantsArr[0].avatar ? (\n              <Avatar\n                source={{\n                  uri: `http://10.0.2.2:8005/api/files/avatar/${participantsArr[0].avatar?.filename}`\n                }}\n                size=\"medium\"\n              />\n            ) : (\n              <Avatar\n                size=\"medium\"\n                title={participantsArr[0].firstname[0]\n                  .concat(participantsArr[0].lastname[0])\n                  .toUpperCase()}\n              />\n            )}\n          </View>\n          <View\n            style={{\n              flex: 1,\n              justifyContent: \"space-between\"\n            }}\n          >\n            <View\n              style={{\n                flexDirection: \"row\",\n                flex: 1,\n                justifyContent: \"space-between\"\n              }}\n            >\n              <Text\n                style={{\n                  textAlignVertical: \"bottom\",\n                  fontSize: 16,\n                  fontWeight: \"bold\"\n                }}\n              >\n                {participants}\n              </Text>\n              <Text\n                color=\"grey\"\n                style={{\n                  color: \"grey\",\n                  fontSize: 10,\n                  textAlignVertical: \"bottom\"\n                }}\n              >\n                {_.capitalize(\n                  moment(item.lastMessage.sentAt)\n                    .locale(\"fr\")\n                    .fromNow()\n                )}\n              </Text>\n            </View>\n            <View style={{ flexDirection: \"row\" }}>\n              <View\n                style={{ alignContent: \"center\", justifyContent: \"center\" }}\n              >\n                {item.lastMessage.sender === auth.user._id ? (\n                  <Icon\n                    name=\"arrow-top-right\"\n                    color={theme.colors.grey1}\n                    size={14}\n                  />\n                ) : (\n                  <Icon\n                    name=\"arrow-bottom-left\"\n                    color={theme.colors.grey3}\n                    size={14}\n                  />\n                )}\n              </View>\n              <Text\n                style={{\n                  textAlignVertical: \"center\",\n                  fontSize: 14,\n                  flex: 1\n                }}\n              >\n                {item.lastMessage.text}\n              </Text>\n              <View\n                style={{ alignContent: \"center\", justifyContent: \"center\" }}\n              >\n                <Icon\n                  name=\"dots-horizontal\"\n                  style={{ alignSelf: \"flex-end\" }}\n                  onPress={() => setShowActionMenu(true)}\n                />\n              </View>\n              <Overlay\n                isVisible={showActionMenu}\n                onBackdropPress={() => setShowActionMenu(false)}\n                height=\"auto\"\n              >\n                <Button\n                  title=\"Supprimer la conversation\"\n                  loading={deleting}\n                  onPress={async () => {\n                    setDeleting(true);\n                    await deleteConversation(item._id);\n                    setDeleting(false);\n                    setShowActionMenu(false);\n                    fetchConversations();\n                  }}\n                />\n              </Overlay>\n            </View>\n          </View>\n        </View>\n      </View>\n    </TouchableOpacity>\n  );\n};\n\nconst ChatLobbyScreen = ({\n  navigation,\n  fetchConversations,\n  fetchUsers,\n  chat,\n  users,\n  auth,\n  sendMessage,\n  deleteConversation\n}) => {\n  const [refreshing, setRefreshing] = useState(false);\n  const [search, setSearch] = useState(null);\n  const { theme } = useContext(ThemeContext);\n\n  useEffect(() => {\n    function fetchData() {\n      fetchConversations();\n      fetchUsers();\n    }\n    fetchData();\n  }, []);\n\n  const onRefresh = useCallback(() => {\n    setRefreshing(true);\n    fetchConversations();\n    setRefreshing(false);\n  }, [refreshing]);\n\n  const searchProcess = () => {\n    const searchResults = [];\n    users.users.forEach(user => {\n      if (user._id !== auth.user._id) {\n        if (\n          user.firstname.includes(search.toLowerCase()) === true ||\n          user.lastname.includes(search.toLowerCase())\n        ) {\n          searchResults.push(user);\n        }\n      }\n    });\n    return searchResults;\n  };\n\n  const onSendMessage = async (newMessage, recipient) => {\n    if (!newMessage) {\n      return;\n    }\n    await sendMessage({\n      message: {\n        text: newMessage,\n        sentAt: new Date()\n      },\n      recipients: [recipient]\n    });\n    setSearch(null);\n  };\n\n  return (\n    <View style={{ flex: 1 }}>\n      <View style={{ backgroundColor: \"white\", paddingVertical: 4 }}>\n        <SearchBar\n          placeholder=\"Chercher un alumni ici...\"\n          onChangeText={setSearch}\n          value={search}\n          lightTheme={true}\n          platform=\"android\"\n          containerStyle={{\n            paddingTop: 0,\n            height: 40\n          }}\n        />\n        {users.isLoaded && (\n          <FlatList\n            style={{}}\n            data={search && searchProcess()}\n            renderItem={({ item }) => (\n              <SearchResultItem\n                item={item}\n                theme={theme}\n                onSendMessage={onSendMessage}\n                chat={chat}\n                navigation={navigation}\n              />\n            )}\n            keyExtractor={item => item._id}\n          />\n        )}\n        {!users.isLoaded && (\n          <View\n            style={{\n              flex: 1,\n              alignContent: \"center\",\n              justifyContent: \"center\"\n            }}\n          >\n            <ActivityIndicator size=\"small\" />\n          </View>\n        )}\n      </View>\n      {chat.isLoaded ? (\n        chat.conversations.length > 0 ? (\n          <FlatList\n            style={{}}\n            data={chat.conversations}\n            renderItem={({ item }) => (\n              <Item\n                item={item}\n                auth={auth}\n                navigation={navigation}\n                theme={theme}\n                deleteConversation={deleteConversation}\n                fetchConversations={fetchConversations}\n              />\n            )}\n            keyExtractor={item => item._id}\n            refreshControl={\n              <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />\n            }\n          />\n        ) : (\n          <View\n            style={{\n              flex: 1,\n              alignContent: \"center\",\n              justifyContent: \"center\"\n            }}\n          >\n            <Text style={{ textAlign: \"center\", color: theme.colors.grey3 }}>\n              Aucune conversation\n            </Text>\n            <Button\n              title=\"Rafraichir\"\n              type=\"clear\"\n              onPress={fetchConversations}\n            />\n          </View>\n        )\n      ) : (\n        <View\n          style={{\n            flex: 1,\n            alignContent: \"center\",\n            justifyContent: \"center\"\n          }}\n        >\n          <ActivityIndicator size=\"large\" />\n        </View>\n      )}\n    </View>\n  );\n};\n\nconst mapStateToProps = state => ({\n  auth: state.auth,\n  chat: state.chat,\n  users: state.users\n});\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    fetchConversations: () => dispatch(fetchConversations()),\n    fetchUsers: () => dispatch(fetchUsers()),\n    sendMessage: message => dispatch(sendMessage(message)),\n    deleteConversation: conversation_id =>\n      dispatch(deleteConversation(conversation_id))\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ChatLobbyScreen);\n"]},"metadata":{},"sourceType":"module"}