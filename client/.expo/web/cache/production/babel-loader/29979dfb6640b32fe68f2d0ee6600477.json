{"ast":null,"code":"import io from\"socket.io-client\";import axios from\"axios\";import{apiConfig}from\"../config\";export var devMiddleware=function devMiddleware(store){return function(next){return function(action){console.log(action.type);next(action);};};};var socket;export var socketMiddleware=function socketMiddleware(store){return function(next){return function(action){if(action.type===\"REQUEST_LOG_IN:SUCCESS\"||action.type===\"REQUEST_SIGN_UP:SUCCESS\"){var token=action.data.token;socket=io(apiConfig.baseUrl.replace(\"/api/\",\"\"),{forceNode:true,transportOptions:{polling:{extraHeaders:{\"Access-Control-Allow-Origin\":\"*\",authorization:token}}}});socket.on(\"connected\",function(data){console.log(\"Socket connected\");});socket.on(\"authenticated\",function(data){console.log(\"Socket authenticated\");});socket.on(\"message\",function(data){store.dispatch({type:\"RECEIVE_MESSAGE\",message:data.message,conversation:data.conversation,newConv:data.newConv,receivedAt:new Date()});});}if(action.type.substring(0,6)===\"SOCKET\"){socket.emit(action.event,action.payload);}if(action.type===\"REQUEST_LOG_OUT:SUCCESS\"){socket.disconnect();}next(action);};};};export var axiosMiddleware=function axiosMiddleware(store){return function(next){return function(action){if(action.type.substring(0,7)===\"REQUEST\"&&action.type.includes(\":\")===false){var https;if(action.type.substring(0,14)===\"REQUEST_UPLOAD\"){https=axios.create({baseURL:apiConfig.baseUrl,timeout:3000,headers:{accept:\"application/json\",\"Content-Type\":\"multipart/form-data\",Authorization:\"Bearer \"+store.getState().auth.token}});}else{https=axios.create({baseURL:apiConfig.baseUrl,timeout:3000,headers:{\"Access-Control-Allow-Origin\":\"*\",\"Content-Type\":\"application/json\",Authorization:\"Bearer \"+store.getState().auth.token}});}var request=new Promise(function(resolve,reject){var res;switch(action.method){case\"GET\":res=https.get(action.route);return resolve(res);case\"POST\":res=https.post(action.route,action.payload);return resolve(res);case\"DELETE\":res=https.delete(action.route,action.payload);return resolve(res);case\"PATCH\":res=https.patch(action.route,action.payload);return resolve(res);default:return;}});request.then(function(res){if(action.successNotification){store.dispatch({type:\"NOTIFY_USER\",notification:action.successNotification});}store.dispatch({type:action.type+\":SUCCESS\",data:res.data,receivedAt:new Date()});}).catch(function(err){console.log(err);store.dispatch({type:action.type+\":ERROR\",error:err,receivedAt:new Date()});if(action.errorNotification){store.dispatch({type:\"NOTIFY_USER\",notification:action.errorNotification});}});next(action);}else{next(action);}};};};","map":{"version":3,"sources":["/home/gaetan/Documents/GATE/app/frontend/src/store/reduxMiddlewares.js"],"names":["io","axios","apiConfig","devMiddleware","store","next","action","console","log","type","socket","socketMiddleware","token","data","baseUrl","replace","forceNode","transportOptions","polling","extraHeaders","authorization","on","dispatch","message","conversation","newConv","receivedAt","Date","substring","emit","event","payload","disconnect","axiosMiddleware","includes","https","create","baseURL","timeout","headers","accept","Authorization","getState","auth","request","Promise","resolve","reject","res","method","get","route","post","delete","patch","then","successNotification","notification","catch","err","error","errorNotification"],"mappings":"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","sourcesContent":["import io from \"socket.io-client\";\nimport axios from \"axios\";\nimport { apiConfig } from \"../config\";\n\nexport const devMiddleware = store => next => action => {\n  console.log(action.type);\n  next(action);\n};\n\nlet socket;\nexport const socketMiddleware = store => next => action => {\n  if (\n    action.type === \"REQUEST_LOG_IN:SUCCESS\" ||\n    action.type === \"REQUEST_SIGN_UP:SUCCESS\"\n  ) {\n    const { token } = action.data;\n\n    socket = io(apiConfig.baseUrl.replace(\"/api/\", \"\"), {\n      forceNode: true,\n      transportOptions: {\n        polling: {\n          extraHeaders: {\n            \"Access-Control-Allow-Origin\": \"*\",\n            authorization: token\n          }\n        }\n      }\n    });\n    socket.on(\"connected\", data => {\n      console.log(\"Socket connected\");\n    });\n    socket.on(\"authenticated\", data => {\n      console.log(\"Socket authenticated\");\n    });\n\n    socket.on(\"message\", data => {\n      store.dispatch({\n        type: \"RECEIVE_MESSAGE\",\n        message: data.message,\n        conversation: data.conversation,\n        newConv: data.newConv,\n        receivedAt: new Date()\n      });\n    });\n  }\n  if (action.type.substring(0, 6) === \"SOCKET\") {\n    socket.emit(action.event, action.payload);\n  }\n  if (action.type === \"REQUEST_LOG_OUT:SUCCESS\") {\n    socket.disconnect();\n  }\n  next(action);\n};\n\nexport const axiosMiddleware = store => next => action => {\n  if (\n    action.type.substring(0, 7) === \"REQUEST\" &&\n    action.type.includes(\":\") === false\n  ) {\n    let https;\n    if (action.type.substring(0, 14) === \"REQUEST_UPLOAD\") {\n      https = axios.create({\n        baseURL: apiConfig.baseUrl,\n        timeout: 3000,\n        headers: {\n          accept: \"application/json\",\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: `Bearer ${store.getState().auth.token}`\n        }\n      });\n    } else {\n      https = axios.create({\n        baseURL: apiConfig.baseUrl,\n        timeout: 3000,\n        headers: {\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${store.getState().auth.token}`\n        }\n      });\n    }\n    const request = new Promise(function(resolve, reject) {\n      let res;\n\n      switch (action.method) {\n        case \"GET\":\n          res = https.get(action.route);\n          return resolve(res);\n        case \"POST\":\n          res = https.post(action.route, action.payload);\n          return resolve(res);\n        case \"DELETE\":\n          res = https.delete(action.route, action.payload);\n          return resolve(res);\n        case \"PATCH\":\n          res = https.patch(action.route, action.payload);\n          return resolve(res);\n        default:\n          return;\n      }\n    });\n    request\n      .then(res => {\n        if (action.successNotification) {\n          store.dispatch({\n            type: \"NOTIFY_USER\",\n            notification: action.successNotification\n          });\n        }\n        store.dispatch({\n          type: `${action.type}:SUCCESS`,\n          data: res.data,\n          receivedAt: new Date()\n        });\n      })\n      .catch(err => {\n        console.log(err);\n        store.dispatch({\n          type: `${action.type}:ERROR`,\n          error: err,\n          receivedAt: new Date()\n        });\n        if (action.errorNotification) {\n          store.dispatch({\n            type: \"NOTIFY_USER\",\n            notification: action.errorNotification\n          });\n        }\n      });\n\n    next(action);\n  } else {\n    next(action);\n  }\n};\n"]},"metadata":{},"sourceType":"module"}