{"ast":null,"code":"import io from\"socket.io-client\";import axios from\"axios\";import{apiConfig}from\"../config\";import{showOverlay}from\"../actions/overlayAction\";export var devMiddleware=function devMiddleware(store){return function(next){return function(action){console.log(action.type);return next(action);};};};export var socketMiddleware=function socketMiddleware(){var socket;return function(store){return function(next){return function(action){if(action.type===\"REQUEST_LOG_IN:SUCCESS\"||action.type===\"REQUEST_SIGN_UP:SUCCESS\"||action.type===\"REQUEST_VERIFY_TOKEN:SUCCESS\"){var token=action.data.token;socket=io(apiConfig.baseUrl.replace(\"/api/\",\"\"),{forceNode:true,transportOptions:{polling:{extraHeaders:{\"Access-Control-Allow-Origin\":\"*\",authorization:token}}}});socket.on(\"connected\",function(data){console.log(\"Socket connected\");});socket.on(\"unauthorized\",function(data){console.log(\"Socket disconnected\");});socket.on(\"authenticated\",function(data){console.log(\"Socket authenticated\");});socket.on(\"message\",function(data){store.dispatch({type:\"RECEIVE_MESSAGE\",message:data.message,conversation:data.conversation,newConv:data.newConv,receivedAt:new Date()});});}if(socket){if(action.type.substring(0,6)===\"SOCKET\"){socket.emit(action.event,action.payload);}if(action.type===\"REQUEST_LOG_OUT:SUCCESS\"){socket.disconnect();console.log(\"socket disconnected\");}}return next(action);};};};};export var axiosMiddleware=function axiosMiddleware(store){return function(next){return function(action){if(action.type.substring(0,7)===\"REQUEST\"&&action.type.includes(\":\")===false){var https;if(action.type.substring(0,14)===\"REQUEST_UPLOAD\"){https=axios.create({baseURL:apiConfig.baseUrl,timeout:3000,headers:{accept:\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Content-Type\":\"multipart/form-data\",Authorization:\"Bearer \"+store.getState().auth.token}});}else{https=axios.create({baseURL:apiConfig.baseUrl,timeout:3000,headers:{\"Access-Control-Allow-Origin\":\"*\",\"Content-Type\":\"application/json\",Authorization:\"Bearer \"+store.getState().auth.token}});}var request=new Promise(function(resolve,reject){var res;switch(action.method){case\"GET\":res=https.get(action.route);return resolve(res);case\"POST\":res=https.post(action.route,action.payload);return resolve(res);case\"DELETE\":res=https.delete(action.route,action.payload);return resolve(res);case\"PATCH\":res=https.patch(action.route,action.payload);return resolve(res);default:return;}});request.then(function(res){if(action.successNotification){store.dispatch(showOverlay({timeout:3000,redirect:action.successNotification.redirect,dispatchCallback:action.successNotification.dispatchCallback,notification:{variant:\"success\",message:action.successNotification.message}}));}return store.dispatch({type:action.type+\":SUCCESS\",data:res.data,receivedAt:new Date()});}).catch(function(err){var _err$response;console.log(err);if(action.errorNotification||((_err$response=err.response)==null?void 0:_err$response.data.forceReconnect)===true){var _err$response2,_err$response3;store.dispatch(showOverlay({timeout:3000,dispatchCallback:((_err$response2=err.response)==null?void 0:_err$response2.data.forceReconnect)&&\"REQUEST_LOG_OUT:SUCCESS\",notification:{variant:\"error\",message:((_err$response3=err.response)==null?void 0:_err$response3.data.message)||\"Cela n'a pas marché...\"}}));}return store.dispatch({type:action.type+\":ERROR\",error:err,receivedAt:new Date()});});return next(action);}else{return next(action);}};};};","map":{"version":3,"sources":["/home/gaetan/Documents/GATE/app/client/src/store/reduxMiddlewares.js"],"names":["io","axios","apiConfig","showOverlay","devMiddleware","store","next","action","console","log","type","socketMiddleware","socket","token","data","baseUrl","replace","forceNode","transportOptions","polling","extraHeaders","authorization","on","dispatch","message","conversation","newConv","receivedAt","Date","substring","emit","event","payload","disconnect","axiosMiddleware","includes","https","create","baseURL","timeout","headers","accept","Authorization","getState","auth","request","Promise","resolve","reject","res","method","get","route","post","delete","patch","then","successNotification","redirect","dispatchCallback","notification","variant","catch","err","errorNotification","response","forceReconnect","error"],"mappings":"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","sourcesContent":["import io from \"socket.io-client\";\nimport axios from \"axios\";\nimport { apiConfig } from \"../config\";\nimport { showOverlay } from \"../actions/overlayAction\";\n\nexport const devMiddleware = (store) => (next) => (action) => {\n  console.log(action.type);\n  return next(action);\n};\n\nexport const socketMiddleware = () => {\n  let socket;\n  return (store) => (next) => (action) => {\n    if (\n      action.type === \"REQUEST_LOG_IN:SUCCESS\" ||\n      action.type === \"REQUEST_SIGN_UP:SUCCESS\" ||\n      action.type === \"REQUEST_VERIFY_TOKEN:SUCCESS\"\n    ) {\n      const { token } = action.data;\n      socket = io(apiConfig.baseUrl.replace(\"/api/\", \"\"), {\n        forceNode: true,\n        transportOptions: {\n          polling: {\n            extraHeaders: {\n              \"Access-Control-Allow-Origin\": \"*\",\n              authorization: token,\n            },\n          },\n        },\n      });\n      socket.on(\"connected\", (data) => {\n        console.log(\"Socket connected\");\n      });\n      socket.on(\"unauthorized\", (data) => {\n        console.log(\"Socket disconnected\");\n      });\n      socket.on(\"authenticated\", (data) => {\n        console.log(\"Socket authenticated\");\n      });\n      socket.on(\"message\", (data) => {\n        store.dispatch({\n          type: \"RECEIVE_MESSAGE\",\n          message: data.message,\n          conversation: data.conversation,\n          newConv: data.newConv,\n          receivedAt: new Date(),\n        });\n      });\n    }\n    if (socket) {\n      if (action.type.substring(0, 6) === \"SOCKET\") {\n        socket.emit(action.event, action.payload);\n      }\n      if (action.type === \"REQUEST_LOG_OUT:SUCCESS\") {\n        socket.disconnect();\n        console.log(\"socket disconnected\");\n      }\n    }\n    return next(action);\n  };\n};\n\nexport const axiosMiddleware = (store) => (next) => (action) => {\n  if (\n    action.type.substring(0, 7) === \"REQUEST\" &&\n    action.type.includes(\":\") === false\n  ) {\n    let https;\n    if (action.type.substring(0, 14) === \"REQUEST_UPLOAD\") {\n      https = axios.create({\n        baseURL: apiConfig.baseUrl,\n        timeout: 3000,\n        headers: {\n          accept: \"application/json\",\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: `Bearer ${store.getState().auth.token}`,\n        },\n      });\n    } else {\n      https = axios.create({\n        baseURL: apiConfig.baseUrl,\n        timeout: 3000,\n        headers: {\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${store.getState().auth.token}`,\n        },\n      });\n    }\n    const request = new Promise(function (resolve, reject) {\n      let res;\n\n      switch (action.method) {\n        case \"GET\":\n          res = https.get(action.route);\n          return resolve(res);\n        case \"POST\":\n          res = https.post(action.route, action.payload);\n          return resolve(res);\n        case \"DELETE\":\n          res = https.delete(action.route, action.payload);\n          return resolve(res);\n        case \"PATCH\":\n          res = https.patch(action.route, action.payload);\n          return resolve(res);\n        default:\n          return;\n      }\n    });\n    request\n      .then((res) => {\n        if (action.successNotification) {\n          store.dispatch(\n            showOverlay({\n              timeout: 3000,\n              redirect: action.successNotification.redirect,\n              dispatchCallback: action.successNotification.dispatchCallback,\n              notification: {\n                variant: \"success\",\n                message: action.successNotification.message,\n              },\n            })\n          );\n        }\n        return store.dispatch({\n          type: `${action.type}:SUCCESS`,\n          data: res.data,\n          receivedAt: new Date(),\n        });\n      })\n      .catch((err) => {\n        console.log(err);\n        if (\n          action.errorNotification ||\n          err.response?.data.forceReconnect === true\n        ) {\n          store.dispatch(\n            showOverlay({\n              timeout: 3000,\n              dispatchCallback:\n                err.response?.data.forceReconnect && \"REQUEST_LOG_OUT:SUCCESS\",\n              notification: {\n                variant: \"error\",\n                message: err.response?.data.message || \"Cela n'a pas marché...\",\n              },\n            })\n          );\n        }\n        return store.dispatch({\n          type: `${action.type}:ERROR`,\n          error: err,\n          receivedAt: new Date(),\n        });\n      });\n\n    return next(action);\n  } else {\n    return next(action);\n  }\n};\n"]},"metadata":{},"sourceType":"module"}